"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var List=function(){function a(b){var c=b.data,d=b.config,e=b.api;_classCallCheck(this,a),this._elements={wrapper:null},this.settings=[{name:"unordered",title:"Unordered",icon:"<svg width=\"17\" height=\"13\" viewBox=\"0 0 17 13\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M5.625 4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0-4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0 9.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm-4.5-5a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0-4.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0 9.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25z\"/></svg>",default:!0},{name:"ordered",title:"Ordered",icon:"<svg width=\"17\" height=\"13\" viewBox=\"0 0 17 13\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M5.819 4.607h9.362a1.069 1.069 0 0 1 0 2.138H5.82a1.069 1.069 0 1 1 0-2.138zm0-4.607h9.362a1.069 1.069 0 0 1 0 2.138H5.82a1.069 1.069 0 1 1 0-2.138zm0 9.357h9.362a1.069 1.069 0 0 1 0 2.138H5.82a1.069 1.069 0 0 1 0-2.137zM1.468 4.155V1.33c-.554.404-.926.606-1.118.606a.338.338 0 0 1-.244-.104A.327.327 0 0 1 0 1.59c0-.107.035-.184.105-.234.07-.05.192-.114.369-.192.264-.118.475-.243.633-.373.158-.13.298-.276.42-.438a3.94 3.94 0 0 1 .238-.298C1.802.019 1.872 0 1.975 0c.115 0 .208.042.277.127.07.085.105.202.105.351v3.556c0 .416-.15.624-.448.624a.421.421 0 0 1-.32-.127c-.08-.085-.121-.21-.121-.376zm-.283 6.664h1.572c.156 0 .275.03.358.091a.294.294 0 0 1 .123.25.323.323 0 0 1-.098.238c-.065.065-.164.097-.296.097H.629a.494.494 0 0 1-.353-.119.372.372 0 0 1-.126-.28c0-.068.027-.16.081-.273a.977.977 0 0 1 .178-.268c.267-.264.507-.49.722-.678.215-.188.368-.312.46-.371.165-.11.302-.222.412-.334.109-.112.192-.226.25-.344a.786.786 0 0 0 .085-.345.6.6 0 0 0-.341-.553.75.75 0 0 0-.345-.08c-.263 0-.47.11-.62.329-.02.029-.054.107-.101.235a.966.966 0 0 1-.16.295c-.059.069-.145.103-.26.103a.348.348 0 0 1-.25-.094.34.34 0 0 1-.099-.258c0-.132.031-.27.093-.413.063-.143.155-.273.279-.39.123-.116.28-.21.47-.282.189-.072.411-.107.666-.107.307 0 .569.045.786.137a1.182 1.182 0 0 1 .618.623 1.18 1.18 0 0 1-.096 1.083 2.03 2.03 0 0 1-.378.457c-.128.11-.344.282-.646.517-.302.235-.509.417-.621.547a1.637 1.637 0 0 0-.148.187z\"/></svg>",default:!1}],this._data={style:this.settings.find(function(a){return!0===a.default}).name,items:[]},this.api=e,this.data=c}return _createClass(a,null,[{key:"enableLineBreaks",get:function(){return!0}},{key:"toolbox",get:function(){return{icon:"<svg width=\"17\" height=\"13\" viewBox=\"0 0 17 13\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M5.625 4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0-4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0 9.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm-4.5-5a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0-4.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0 9.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25z\"/></svg>",title:"List"}}}]),_createClass(a,[{key:"render",value:function(){var a=this,b="ordered"===this._data.style?this.CSS.wrapperOrdered:this.CSS.wrapperUnordered,c="ordered"===this._data.style?"ol":"ul";return this._elements.wrapper=this._make(c,[this.CSS.baseBlock,this.CSS.wrapper,b],{contentEditable:!0}),this._data.items.length?this._data.items.forEach(function(b){a._elements.wrapper.appendChild(a._make("li",a.CSS.item,{innerHTML:b.text},b.children))}):this._elements.wrapper.appendChild(this._make("li",this.CSS.item)),this._elements.wrapper.addEventListener("keydown",function(b){switch(b.keyCode){case 13:a.getOutofList(b);break;case 8:a.backspace(b);}},!1),this._elements.wrapper}},{key:"save",value:function(){return this.data}},{key:"renderSettings",value:function(){var a=this,b=this._make("div",[this.CSS.settingsWrapper],{});return this.settings.forEach(function(c){var d=a._make("div",a.CSS.settingsButton,{innerHTML:c.icon});d.addEventListener("click",function(){a.toggleTune(c.name);var b=d.parentNode.querySelectorAll(".".concat(a.CSS.settingsButton));Array.from(b).forEach(function(b){return b.classList.remove(a.CSS.settingsButtonActive)}),d.classList.toggle(a.CSS.settingsButtonActive)}),a._data.style===c.name&&d.classList.add(a.CSS.settingsButtonActive),b.appendChild(d)}),b}},{key:"onPaste",value:function(a){var b=a.detail.data;this.data=this.pasteHandler(b)}},{key:"toggleTune",value:function(a){this._elements.wrapper.classList.toggle(this.CSS.wrapperOrdered,"ordered"===a),this._elements.wrapper.classList.toggle(this.CSS.wrapperUnordered,"unordered"===a),this._data.style=a}},{key:"buildData",value:function(a){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g,h=a[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,b.push({text:g.childNodes&&g.innerHTML?g.innerHTML.split("<li")[0].trim():"",children:{style:g.querySelectorAll(":scope > .".concat(this.CSS.wrapperNested)).length&&"OL"===g.querySelectorAll(":scope > .".concat(this.CSS.wrapperNested))[0].tagName.toUpperCase()?"ordered":"unordered",items:this.buildData(g.querySelectorAll(":scope > .".concat(this.CSS.wrapperNested," > .").concat(this.CSS.item)))}})}catch(a){d=!0,e=a}finally{try{c||null==h.return||h.return()}finally{if(d)throw e}}return b}},{key:"_make",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=document.createElement(a);if(Array.isArray(b)){var f;(f=e.classList).add.apply(f,_toConsumableArray(b))}else b&&e.classList.add(b);for(var g in c)e[g]=c[g];if(d.items&&d.items.length){var h=e.appendChild(document.createElement("ordered"===d.style?"ol":"ul"));h.classList.add(this.CSS.wrapperNested);var i=!0,j=!1,k=void 0;try{for(var l,m,n=d.items[Symbol.iterator]();!(i=(l=n.next()).done);i=!0)m=l.value,h.appendChild(this._make("li",this.CSS.item,{innerHTML:m.text},m.children))}catch(a){j=!0,k=a}finally{try{i||null==n.return||n.return()}finally{if(j)throw k}}}return e}},{key:"getOutofList",value:function(a){var b=this._elements.wrapper.querySelectorAll(".".concat(this.CSS.item)),c=b[b.length-1],d=this.currentItem;if(d&&d.nextSibling&&"LI"===d.nextSibling.tagName.toUpperCase()&&!d.nextSibling.firstChild.textContent.trim().length){var e=document.createElement("LI");return e.innerHTML="<br>",e.classList.add(this.CSS.item),d.parentNode.insertBefore(e,d.nextSibling),a.preventDefault(),a.stopPropagation(),!1}d!==c||c.textContent.trim().length||(d.parentElement.removeChild(d),this.api.blocks.insert(),this.api.caret.setToBlock(this.api.blocks.getCurrentBlockIndex(),"start",0),a.preventDefault(),a.stopPropagation())}},{key:"backspace",value:function(a){var b=this._elements.wrapper.querySelectorAll(".".concat(this.CSS.item)),c=b[0];c&&(!(2>b.length)||c.innerHTML.trim()||a.preventDefault())}},{key:"selectItem",value:function(a){a.preventDefault();var b=window.getSelection(),c=b.anchorNode.parentNode,d=c.closest(".".concat(this.CSS.item)),e=new Range;e.selectNodeContents(d),b.removeAllRanges(),b.addRange(e)}},{key:"pasteHandler",value:function(a){var b,c=a.tagName;"OL"===c?b="ordered":"UL"===c||"LI"===c?b="unordered":void 0;var d={type:b,items:[]};if("LI"===c)d.items=[a.innerHTML];else{var e=Array.from(a.querySelectorAll("LI"));d.items=e.map(function(a){return a.innerHTML}).filter(function(a){return!!a.trim()})}return d}},{key:"CSS",get:function(){return{baseBlock:this.api.styles.block,wrapper:"cdx-list",wrapperNested:"cdx-list--nested",wrapperOrdered:"cdx-list--ordered",wrapperUnordered:"cdx-list--unordered",item:"cdx-list__item",settingsWrapper:"cdx-list-settings",settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive}}},{key:"data",set:function(a){a||(a={}),this._data.style=a.style||this.settings.find(function(a){return!0===a.default}).name,this._data.items=a.items||[];var b=this._elements.wrapper;b&&b.parentNode.replaceChild(this.render(),b)},get:function(){var a=this._elements.wrapper.querySelectorAll(":scope > .".concat(this.CSS.item));return this._data.items=this.buildData(a),this._data.style="ordered"===this._data.style?"ordered":"unordered",this._data}},{key:"currentItem",get:function(){var a=window.getSelection().anchorNode;return a.nodeType!==Node.ELEMENT_NODE&&(a=a.parentNode),a.closest(".".concat(this.CSS.item))}}],[{key:"formatExportData",value:function(a){var b="",c=!0,d=!1,e=void 0;try{for(var f,g,h=a[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,b+="".concat(g.text,", "),g.children&&g.children.length&&(b+=this.formatExportData(g.children))}catch(a){d=!0,e=a}finally{try{c||null==h.return||h.return()}finally{if(d)throw e}}return b.substring(0,b.length-2)}},{key:"sanitize",get:function(){return{style:{},items:{br:!0,b:!0,i:!0,span:!0,li:!0}}}},{key:"pasteConfig",get:function(){return{tags:["OL","UL","LI"]}}},{key:"conversionConfig",get:function(){var a=this;return{export:function(b){return a.formatExportData(b.items)},import:function(a){var b=a.split(",");return{items:b.map(function(a){return{text:a.trim(),children:[]}})}}}}}]),a}();