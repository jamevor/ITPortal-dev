"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}var subTypes=window.subTypes;$(document).ready(function(){var a=new EditorJS({holder:"details",placeholder:"Begin your description here...",minHeight:1,tools:{paragraph:{inlineToolbar:["bold","italic"]},header:{class:Header,config:{minHeader:3,maxHeader:6,defaultLevel:3}},list:{class:List,inlineToolbar:["bold","italic","inlineCode","outdent","indent","styleToggle"]},inlineCode:{class:InlineCode},indent:{class:ListIndent},outdent:{class:ListOutdent},styleToggle:{class:ListStyleToggle},image:{class:ImageTool,config:{field:"fileupload",endpoints:{byFile:"/api/v1/file-upload/create/one",byUrl:"/api/v1/file-upload/create/one"},additionalRequestData:{via:"editorjs"}}}},data:window.editorjs_initialize_data.details});$("#file").change(function(){if($("#img-changed").val("true"),$("#button-remove-image").show(),$("#img-removed").val("false"),$("#file")&&$("#file")[0]&&$("#file")[0].files&&$("#file")[0].files[0]){var a=new FileReader;a.onload=function(a){$(".section-img").css("background-image","url('".concat(a.target.result,"')"))},a.readAsDataURL($("#file")[0].files[0])}enableSave()}),$("#button-remove-image").click(function(a){a.preventDefault(),$(".section-img").css("background-image",""),$("#button-remove-image").hide(),$("#img-removed").val("true"),enableSave()}),$(".article-heading").on("keyup change paste",function(){$(".breadcrumbs li:last-child > a").text($(".article-heading").text())}),$("#status").change(function(){var a=$("#status").find("option:selected"),b={color:$(a).data("color"),icon:$(a).data("icon"),title:$(a).data("title")};$(".news-status-card").css("background","#".concat(b.color)),$(".news-status-icon i").removeClass().addClass(["far","fa-2x",b.icon]),$(".news-status-title").text(b.title)}),$("#actionTitle").easyAutocomplete({url:"/api/v1/action/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#action").val(JSON.stringify($("#actionTitle").getSelectedItemData()))},showAnimation:{type:"slide",time:300,callback:function(){}},hideAnimation:{type:"slide",time:300,callback:function(){}}},template:{type:"custom",method:function(a,b){return actionToDOM(b,!1)}},placeholder:"Search for an action...",requestDelay:200}),$("#add-action-button").click(function(a){a.preventDefault(),$("#action").val().length&&(renderAction(JSON.parse($("#action").val())),$("#action, #actionTitle").val(""))}),$("#link-cards-action").on("click",".remove-action-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-tag-input").easyAutocomplete({url:"/api/v1/tag/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#tag").val(JSON.stringify($("#add-tag-input").getSelectedItemData()))}},requestDelay:200}),$("#add-tag-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-tag-input").val().length&&(renderTag(JSON.parse($("#tag").val())),$("#add-tag-input, #tag").val(""))}),$(".tags").on("click",".remove-tag-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-audience-input").easyAutocomplete({url:"/api/v1/audience/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#audience").val(JSON.stringify($("#add-audience-input").getSelectedItemData()))}},requestDelay:200}),$("#add-audience-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-audience-input").val().length&&(renderAudience(JSON.parse($("#audience").val())),$("#add-audience-input, #audience").val(""))}),$(".audience").on("click",".remove-audience-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$(".link-cards, .news-sub").on("click",".remove-catalog-item-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-component-input").easyAutocomplete({url:"/api/v1/component/get/all",getValue:"title",list:{maxNumberOfElements:3,match:{enabled:!0},onChooseEvent:function(){$("#component").val(JSON.stringify($("#add-component-input").getSelectedItemData()))}},template:{type:"custom",method:function(a,b){return catalogItemToDOM(b,"component",!1,!0)}},placeholder:"Search for a component...",requestDelay:200}),$("#add-component-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-component-input").val().length&&(renderCatalogItem(JSON.parse($("#component").val()),"component"),$("#add-component-input, #component").val(""))}),$("#add-component-button").click(function(a){a.preventDefault(),$("#component").val().length&&(renderCatalogItem(JSON.parse($("#component").val()),"component"),$("#add-component-input, #component").val(""))}),$("#add-service-input").easyAutocomplete({url:"/api/v1/service/get/all",getValue:"title",list:{maxNumberOfElements:3,match:{enabled:!0},onChooseEvent:function(){$("#service").val(JSON.stringify($("#add-service-input").getSelectedItemData()))}},template:{type:"custom",method:function(a,b){return catalogItemToDOM(b,"service",!1,!0)}},placeholder:"Search for a service...",requestDelay:200}),$("#add-service-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-service-input").val().length&&(renderCatalogItem(JSON.parse($("#service").val()),"service"),$("#add-service-input, #service").val(""))}),$("#add-service-button").click(function(a){a.preventDefault(),$("#service").val().length&&(renderCatalogItem(JSON.parse($("#service").val()),"service"),$("#add-service-input, #service").val(""))}),$("#add-software-input").easyAutocomplete({url:"/api/v1/software/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#software").val(JSON.stringify($("#add-software-input").getSelectedItemData()))}},template:{type:"custom",method:function(a,b){return catalogItemToDOM(b,"software",!1,!0)}},placeholder:"Search for software...",requestDelay:200}),$("#add-software-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-software-input").val().length&&(renderCatalogItem(JSON.parse($("#software").val()),"software"),$("#add-software-input, #software").val(""))}),$("#add-software-button").click(function(a){a.preventDefault(),$("#software").val().length&&(renderCatalogItem(JSON.parse($("#software").val()),"software"),$("#add-software-input, #software").val(""))}),$(".news-sub").on("change",".news-sub-type",function(){var a=$(this).children("option:selected"),b={color:$(a).data("color"),colorLight:$(a).data("colorlight"),icon:$(a).data("icon")},c=$(this).closest(".news-sub-item").first();$(c).find(".news-sub-item-icon").css("background",b.color).find("i").removeClass().addClass(["far","fa-fw",b.icon]),$(c).find(".news-sub-item-event").css("background",b.colorLight)}),$("#button-add-update").click(function(a){a.preventDefault(),createNewsSub()}),$(".news-sub").on("click",".button-open-news-sub-add-action-modal",function(a){$("#cursor-news-sub-id").val($(a.currentTarget).closest(".news-sub-item").data("newssubid"))}),$("#news-sub-action-input").easyAutocomplete({url:"/api/v1/action/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#news-sub-action").val(JSON.stringify($("#news-sub-action-input").getSelectedItemData()))},showAnimation:{type:"slide",time:300,callback:function(){}},hideAnimation:{type:"slide",time:300,callback:function(){}}},placeholder:"Search for an action...",requestDelay:200}),$("#news-sub-add-action-button").click(function(a){a.preventDefault(),$("#news-sub-action").val().length&&(addActionToNewsSub($("#cursor-news-sub-id").val(),JSON.parse($("#news-sub-action").val())),$("#news-sub-action, #news-sub-action-input").val(""))}),$(".news-sub").on("click",".remove-action-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$(".news-sub").on("click",".remove-news-sub-button",function(a){a.preventDefault(),$(a.currentTarget).closest(".news-sub-item").slideUp(500,function(){$(this).remove()}),enableSave()}),$(".button-save").click(function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(c){var d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c.preventDefault(),!$(c.currentTarget).hasClass("disabled")){b.next=3;break}return b.abrupt("return",!1);case 3:return d=$("#link-cards-action").children("li").map(function(a,b){return $(b).data("actionid")}).toArray(),e=$(".tags").children("li.tag").map(function(a,b){return $(b).data("tagid")}).toArray(),f=$(".audience").children("li.audience-item").map(function(a,b){return $(b).data("audienceid")}).toArray(),g=$(".service-item").not(".ignore").map(function(a,b){return $(b).data("serviceid")}).toArray(),h=$(".component-item").not(".ignore").map(function(a,b){return $(b).data("componentid")}).toArray(),j=$(".software-item").not(".ignore").map(function(a,b){return $(b).data("softwareid")}).toArray(),k=$(".news-sub-item").not(".timestamp").map(function(a,b){return{id:$(b).data("newssubid"),isNew:$(b).data("isnew"),newsSubType:$(b).find(".news-sub-type").first().val(),title:$(b).find(".news-sub-title").first().text(),descriptionShort:$(b).find(".news-sub-description-short").first().text(),datePost:$(b).find(".news-sub-date-post").first().val(),actions:$(b).find(".news-sub-action-item").map(function(a,b){return $(b).data("actionid")}).toArray()}}).toArray(),l=new FormData,l.append("title",$("#article-title").text()),l.append("idNewsPhase",$("#phase").val()),l.append("idNewsType",$("#newsType").val()),l.append("idNewsStatus",$("#status").val()),l.append("descriptionShort",$("#article-summary").text()),l.append("why",$("#why").text()),l.append("impact",$("#impact").text()),l.append("benefits",$("#benefits").text()),l.append("actionDescription",$("#action-description").text()),b.t0=l,b.t1=JSON,b.next=24,a.save();case 24:for(b.t2=b.sent,b.t3=b.t1.stringify.call(b.t1,b.t2),b.t0.append.call(b.t0,"details",b.t3),l.append("datePost",$("#datePost").val()),l.append("dateStart",$("#dateStart").val()),l.append("dateEnd",$("#dateEnd").val()),l.append("showAlert",$("#showAlert").is(":checked")),l.append("isWPIToday",$("#isWPIToday").is(":checked")),l.append("isPinned",$("#isPinned").is(":checked")),l.append("isHome",$("#isHome").is(":checked")),"true"===$("#img-changed").val()&&l.append("fileupload",$("#file")[0].files[0]),l.append("imageRemoved",$("#img-removed").val()),m=!0,n=!1,o=void 0,b.prev=39,p=d[Symbol.iterator]();!(m=(q=p.next()).done);m=!0)r=q.value,l.append("actions[]",r);b.next=47;break;case 43:b.prev=43,b.t4=b["catch"](39),n=!0,o=b.t4;case 47:b.prev=47,b.prev=48,m||null==p.return||p.return();case 50:if(b.prev=50,!n){b.next=53;break}throw o;case 53:return b.finish(50);case 54:return b.finish(47);case 55:for(s=!0,t=!1,u=void 0,b.prev=58,v=e[Symbol.iterator]();!(s=(w=v.next()).done);s=!0)x=w.value,l.append("tags[]",x);b.next=66;break;case 62:b.prev=62,b.t5=b["catch"](58),t=!0,u=b.t5;case 66:b.prev=66,b.prev=67,s||null==v.return||v.return();case 69:if(b.prev=69,!t){b.next=72;break}throw u;case 72:return b.finish(69);case 73:return b.finish(66);case 74:for(y=!0,z=!1,A=void 0,b.prev=77,B=f[Symbol.iterator]();!(y=(C=B.next()).done);y=!0)D=C.value,l.append("audiences[]",D);b.next=85;break;case 81:b.prev=81,b.t6=b["catch"](77),z=!0,A=b.t6;case 85:b.prev=85,b.prev=86,y||null==B.return||B.return();case 88:if(b.prev=88,!z){b.next=91;break}throw A;case 91:return b.finish(88);case 92:return b.finish(85);case 93:for(E=!0,F=!1,G=void 0,b.prev=96,H=g[Symbol.iterator]();!(E=(I=H.next()).done);E=!0)J=I.value,l.append("services[]",J);b.next=104;break;case 100:b.prev=100,b.t7=b["catch"](96),F=!0,G=b.t7;case 104:b.prev=104,b.prev=105,E||null==H.return||H.return();case 107:if(b.prev=107,!F){b.next=110;break}throw G;case 110:return b.finish(107);case 111:return b.finish(104);case 112:for(K=!0,L=!1,M=void 0,b.prev=115,N=h[Symbol.iterator]();!(K=(O=N.next()).done);K=!0)P=O.value,l.append("components[]",P);b.next=123;break;case 119:b.prev=119,b.t8=b["catch"](115),L=!0,M=b.t8;case 123:b.prev=123,b.prev=124,K||null==N.return||N.return();case 126:if(b.prev=126,!L){b.next=129;break}throw M;case 129:return b.finish(126);case 130:return b.finish(123);case 131:for(Q=!0,R=!1,S=void 0,b.prev=134,T=j[Symbol.iterator]();!(Q=(U=T.next()).done);Q=!0)V=U.value,l.append("software[]",V);b.next=142;break;case 138:b.prev=138,b.t9=b["catch"](134),R=!0,S=b.t9;case 142:b.prev=142,b.prev=143,Q||null==T.return||T.return();case 145:if(b.prev=145,!R){b.next=148;break}throw S;case 148:return b.finish(145);case 149:return b.finish(142);case 150:W=0,X=!0,Y=!1,Z=void 0,b.prev=154,_=k[Symbol.iterator]();case 156:if(X=(aa=_.next()).done){b.next=190;break}ba=aa.value,b.t10=regeneratorRuntime.keys(ba);case 159:if((b.t11=b.t10()).done){b.next=186;break}if(ca=b.t11.value,"actions"!=ca){b.next=183;break}for(da=!0,ea=!1,fa=void 0,b.prev=165,ga=ba[ca][Symbol.iterator]();!(da=(ha=ga.next()).done);da=!0)ia=ha.value,l.append("newsSubs[".concat(W,"][").concat(ca,"][]"),ia);b.next=173;break;case 169:b.prev=169,b.t12=b["catch"](165),ea=!0,fa=b.t12;case 173:b.prev=173,b.prev=174,da||null==ga.return||ga.return();case 176:if(b.prev=176,!ea){b.next=179;break}throw fa;case 179:return b.finish(176);case 180:return b.finish(173);case 181:b.next=184;break;case 183:l.append("newsSubs[".concat(W,"][").concat(ca,"]"),ba[ca]);case 184:b.next=159;break;case 186:++W;case 187:X=!0,b.next=156;break;case 190:b.next=196;break;case 192:b.prev=192,b.t13=b["catch"](154),Y=!0,Z=b.t13;case 196:b.prev=196,b.prev=197,X||null==_.return||_.return();case 199:if(b.prev=199,!Y){b.next=202;break}throw Z;case 202:return b.finish(199);case 203:return b.finish(196);case 204:$.ajax({url:$("#update-endpoint").val(),method:$("#update-method").val(),contentType:!1,processData:!1,data:l,success:function(a){disableSave(),a.created?window.location.replace("/news/"+a.news.id):window.location.reload()},error:function(){$("#toast-save-error").addClass("show")}});case 205:case"end":return b.stop();}},b,null,[[39,43,47,55],[48,,50,54],[58,62,66,74],[67,,69,73],[77,81,85,93],[86,,88,92],[96,100,104,112],[105,,107,111],[115,119,123,131],[124,,126,130],[134,138,142,150],[143,,145,149],[154,192,196,204],[165,169,173,181],[174,,176,180],[197,,199,203]])}));return function(){return b.apply(this,arguments)}}()),$(".article, .console-modal").on("keyup change paste",":input, [contenteditable=true]",function(){$("#article-title").text().length?enableSave():disableSave()}),$(".article").on("click",".ce-settings__plugin-zone *, .ce-settings__default-zone *",function(){$("#article-title").text().length?enableSave():disableSave()}),$("#button-generate-preview").click(function(a){a.preventDefault(),$.ajax({url:"/api/v1/preview/create/one",method:"POST",data:{entity:"news",entityID:$("#news-id").val()},success:function(a){$("#preview-link").val(a.link),$("#modal-preview").foundation("open")},error:function(a){console.error(a)}})})});var renderAction=function(a){var b=!1,c=!1;$("#link-cards-action").children().each(function(){return $(this).data("actionid")==a.id?(c=!0,!1):$(this).text()>a.title?(b=!0,$(this).before(actionToDOM(a,!1,!0)),!1):void 0}),b||c||$("#link-cards-action").append(actionToDOM(a,!1,!0))},actionToDOM=function(a,b,c){return b=null==b||b,c=null!=c&&c,"<li data-actionid=\"".concat(a.id,"\"><a class=\"").concat(a.actionType.title,"\" target=\"_self\" href=\"").concat(b?a.link:"#","\">").concat(a.title).concat(c?"<button class='remove-action-button'><i class='fas fa-times-circle'></i></button>":"","</a></li>")},renderTag=function(a){var b=!1,c=!1;$(".tags").children(".tag").each(function(){return $(this).data("tagid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(tagToDOM(a)),!1):void 0}),b||c||($(".tags").children(".tag").length?$(".tags").children(".tag").last().before(tagToDOM(a)):$(".tags").children().last().before(tagToDOM(a)))},tagToDOM=function(a){return"<li data-tagid=\"".concat(a.id,"\" class=\"tag\"><a href=\"#\">").concat(a.title,"<button class='remove-tag-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderAudience=function(a){var b=!1,c=!1;$(".audience").children(".audience-item").each(function(){return $(this).data("audienceid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(audienceToDOM(a)),!1):void 0}),b||c||($(".audience").children(".audience-item").length?$(".audience").children(".audience-item").last().before(audienceToDOM(a)):$(".audience").children().last().before(audienceToDOM(a)))},audienceToDOM=function(a){return"<li data-audienceid=\"".concat(a.id,"\" class=\"audience-item\"><a href=\"#\">").concat(a.title,"<button class='remove-audience-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderCatalogItem=function(a,b){var c=!1,d=!1;$(".catalog-items > li.".concat(b,"-item")).each(function(){return $(this).data("".concat(b,"id"))==a.id?(d=!0,!1):$(this).children("a").text()>a.title?(c=!0,$(this).before(catalogItemToDOM(a,b,!0)),!1):void 0}),c||d||($(".catalog-items > li.".concat(b,"-item")).length?$(".catalog-items > li.".concat(b,"-item")).last().after(catalogItemToDOM(a,b,!0)):$("#add-".concat(b,"-input")).closest("li").append(catalogItemToDOM(a,b,!0)))},catalogItemToDOM=function(a,b,c,d){return c=null!=c&&c,d=null!=d&&d,"<li data-".concat(b,"id=\"").concat(a.id,"\" class=\"").concat(b,"-item").concat(d?" ignore":"","\"><a class=\"catalog\" href=\"#\">").concat(a.title).concat(c?"<button class='remove-catalog-item-button'><i class='fas fa-times-circle'></i></button>":"","</a></li>")},createNewsSub=function(){var a=newsSubToDOM({idNewsSubType:4,title:"",descriptionShort:"",newsSubType:window.subTypes[3],actions:[]});$(".news-sub").children(".news-sub-item").length?$(".news-sub").children(".news-sub-item").first().before(a):$(".news-sub").append(a)},newsSubToDOM=function(a){a.id=a.id||Math.random();var b=ColorConverter("#".concat(a.newsSubType.color),"hex");return"\n  <div class=\"news-sub-item".concat(a&&a.datePost&&a.datePost>new Date?" future":"","\" data-newsSubId=\"").concat(a.id,"\" data-isNew=\"true\">\n    <div class=\"news-sub-item-icon\" style=\"background: ").concat(b.toHSL().toCSS(),";\">\n      <i class=\"far fa-fw ").concat(a&&a.newsSubType&&a.newsSubType.icon?a.newsSubType.icon:"fa-clock","\"></i>\n    </div>\n    <div class=\"news-sub-item-event\" style=\"background: ").concat(b.set("l",95).toCSS(),";\">\n        <label for=\"newsSubType-").concat(a.id,"\">Update Type</label>\n        <select name=\"newsSubType\" id=\"newsSubType-").concat(a.id,"\" class='title-case news-sub-type'>\n        ").concat(subTypes.map(function(b){return"\n              <option class='title-case' value=\"".concat(b.id,"\" data-color=\"").concat("#"+b.color,"\"\n              data-colorlight=\"").concat(ColorConverter("#"+b.color,"hex").toHSL().set("l",95).toCSS(),"\"\n              data-icon=\"").concat(b.icon,"\" ").concat(a&&a.idNewsSubType==b.id?"selected":"",">").concat(b.title,"</option>\n            ")}).join(""),"\n        </select>\n        <label for=\"datePost-").concat(a.id,"\">Posted</label>\n        <input type='datetime-local' id=\"datePost-").concat(a.id,"\" class='news-sub-date-post' value=\"").concat(a.datePost?moment(a.datePost).format(moment.HTML5_FMT.DATETIME_LOCAL):moment(new Date).format(moment.HTML5_FMT.DATETIME_LOCAL),"\" name='datePost'>\n        <h3 class=\"news-sub-title\" contenteditable=true placeholder='News update title'>").concat(a.title,"</h3>\n        <p class='news-sub-description-short' contenteditable=true placeholder='News update description'>").concat(a.descriptionShort,"</p>\n        <a data-open=\"news-sub-add-action-modal\" class=\"button-open-news-sub-add-action-modal button-news-update\"><i class='far fa-link'></i> Link Action</a>\n        <ul class=\"news-sub-item-links\">\n        </ul>\n        </div>\n    <button class='remove-news-sub-button'><i class='fas fa-times-circle'></i></button>\n  </div>\n  ")},addActionToNewsSub=function(a,b){var c="<li class=\"news-sub-action-item\" data-actionid=\"".concat(b.id,"\"><a href=\"#\" target=\"self\">").concat(b.title,"<button class='remove-catalog-item-button'><i class='fas fa-times-circle'></i></button></a></li>");$(".news-sub-item[data-newssubid=\"".concat(a,"\"]")).find(".news-sub-item-links").append(c)},enableSave=function(){$(".button-save").removeClass("disabled")},disableSave=function(){$(".button-save").addClass("disabled")};