"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}$(document).ready(function(){$(".article-heading").on("keyup change paste",function(){$(".breadcrumbs li:last-child > a").text($(".article-heading").text())}),$("#add-tag-input").easyAutocomplete({url:"/api/v1/tag/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#tag").val(JSON.stringify($("#add-tag-input").getSelectedItemData()))}},requestDelay:200}),$("#add-tag-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-tag-input").val().length&&(renderTag(JSON.parse($("#tag").val())),$("#add-tag-input, #tag").val(""))}),$(".tags").on("click",".remove-tag-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-audience-input").easyAutocomplete({url:"/api/v1/audience/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#audience").val(JSON.stringify($("#add-audience-input").getSelectedItemData()))}},requestDelay:200}),$("#add-audience-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-audience-input").val().length&&(renderAudience(JSON.parse($("#audience").val())),$("#add-audience-input, #audience").val(""))}),$(".audience").on("click",".remove-audience-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-alias-input").easyAutocomplete({url:"/api/v1/alias/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#alias").val(JSON.stringify($("#add-alias-input").getSelectedItemData()))}},requestDelay:200}),$("#add-alias-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-alias-input").val().length&&(renderAlias(JSON.parse($("#alias").val())),$("#add-alias-input, #alias").val(""))}),$(".alias").on("click",".remove-alias-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-software-input").easyAutocomplete({url:"/api/v1/software/get/all",getValue:"title",list:{maxNumberOfElements:3,match:{enabled:!0},onChooseEvent:function(){$("#software").val(JSON.stringify($("#add-software-input").getSelectedItemData()))}},placeholder:"Search for software...",requestDelay:200}),$("#add-software-button").click(function(a){a.preventDefault(),$("#software").val().length&&(renderSoftware(JSON.parse($("#software").val())),$("#software, #add-software-input").val(""))}),$("#softwareTable tbody").on("click",".button-remove-software",function(a){window.softwareTable.row($(a.currentTarget).closest("tr")).remove(),window.softwareTable.draw(),enableSave()}),$(".console-modal").on("click",".remove-related-item-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-package-input").easyAutocomplete({url:"/api/v1/package/get/all",getValue:"title",list:{maxNumberOfElements:3,match:{enabled:!0},onChooseEvent:function(){$("#package").val(JSON.stringify($("#add-package-input").getSelectedItemData()))}},placeholder:"Search for a package...",requestDelay:200}),$("#add-package-button").click(function(a){a.preventDefault(),$("#package").val().length&&(addRelationshipItem(JSON.parse($("#package").val()),"package"),$("#package","#add-package-input").val(""))}),$(".console-modal").on("click",".remove-related-item-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$(".button-save").click(function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c,d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b.preventDefault(),!$(b.currentTarget).hasClass("disabled")){a.next=3;break}return a.abrupt("return",!1);case 3:c=$(".tags").children("li.tag").map(function(a,b){return $(b).data("tagid")}).toArray(),d=$(".audience").children("li.audience-item").map(function(a,b){return $(b).data("audienceid")}).toArray(),e=$(".alias").children("li.alias-item").map(function(a,b){return $(b).data("aliasid")}).toArray(),f=window.softwareTable.columns(0).data().eq(0).unique().toArray(),g=$(".packages-wrapper").children("li.package-item").map(function(a,b){return $(b).data("packageid")}).toArray(),$.ajax({url:$("#update-endpoint").val(),method:$("#update-method").val(),data:{title:$("#article-title").text(),descriptionShort:$("#article-summary").text(),idServerPhase:$("#phase").val(),requirements:$("#requirements").text(),host:$("#host").val(),tags:c,audiences:d,aliases:e,software:f,packages:g},success:function(a){disableSave(),a.created?window.location.replace("/server/"+a.server.id):$("#toast-save-success").addClass("show")},error:function(){$("#toast-save-error").addClass("show")}});case 9:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()),$(".article, .console-modal").on("keyup change paste",":input, [contenteditable=true]",function(){$("#article-title").text().length?enableSave():disableSave()}),$(".article").on("click",".ce-settings__plugin-zone *, .ce-settings__default-zone *",function(){$("#article-title").text().length?enableSave():disableSave()}),$("#button-generate-preview").click(function(a){a.preventDefault(),$.ajax({url:"/api/v1/preview/create/one",method:"POST",data:{entity:"server",entityID:$("#server-id").val()},success:function(a){$("#preview-link").val(a.link),$("#modal-preview").foundation("open")},error:function(a){console.error(a)}})})});var renderTag=function(a){var b=!1,c=!1;$(".tags").children(".tag").each(function(){return $(this).data("tagid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(tagToDOM(a)),!1):void 0}),b||c||($(".tags").children(".tag").length?$(".tags").children(".tag").last().before(tagToDOM(a)):$(".tags").children().last().before(tagToDOM(a)))},tagToDOM=function(a){return"<li data-tagid=\"".concat(a.id,"\" class=\"tag\"><a href=\"#\">").concat(a.title,"<button class='remove-tag-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderAudience=function(a){var b=!1,c=!1;$(".audience").children(".audience-item").each(function(){return $(this).data("audienceid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(audienceToDOM(a)),!1):void 0}),b||c||($(".audience").children(".audience-item").length?$(".audience").children(".audience-item").last().before(audienceToDOM(a)):$(".audience").children().last().before(audienceToDOM(a)))},audienceToDOM=function(a){return"<li data-audienceid=\"".concat(a.id,"\" class=\"audience-item\"><a href=\"#\">").concat(a.title,"<button class='remove-audience-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderAlias=function(a){var b=!1,c=!1;$(".alias").children(".alias-item").each(function(){return $(this).data("aliasid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(aliasToDOM(a)),!1):void 0}),b||c||($(".alias").children(".alias-item").length?$(".alias").children(".alias-item").last().before(aliasToDOM(a)):$(".alias").children().last().before(aliasToDOM(a)))},aliasToDOM=function(a){return"<li data-aliasid=\"".concat(a.id,"\" class=\"alias-item\"><a href=\"#\">").concat(a.title,"<button class='remove-alias-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderSoftware=function(a){var b=!1;window.softwareTable.rows().every(function(){if(this.data()[0]==a.id)return b=!0,!1}),b||(window.softwareTable.row.add([a.id,a.title?"<a href='#'>".concat(a.title,"</a>"):"",a.version?a.version:"",a.publisher?a.publisher:"","<button class='button-remove-software'><i class='fas fa-unlink'></i> Remove</button>"]),window.softwareTable.draw())},addRelationshipItem=function(a,b){var c=!1,d=!1;$(".".concat(b,"-item")).each(function(){return $(this).data("".concat(b,"id"))==a.id?(d=!0,!1):$(this).text()>a.title?(c=!0,$(this).before(relatedItemToDOM(a,b)),!1):void 0}),c||d||($(".".concat(b,"-item")).length?$(".".concat(b,"-item")).last().after(relatedItemToDOM(a,b)):$(".".concat(b,"s-wrapper")).append(relatedItemToDOM(a,b)))},relatedItemToDOM=function(a,b){return"<li data-".concat(b,"id=\"").concat(a.id,"\" class=\"").concat(b,"-item related-item\">").concat(a.title,"<button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>")},enableSave=function(){$(".button-save").removeClass("disabled")},disableSave=function(){$(".button-save").addClass("disabled")};