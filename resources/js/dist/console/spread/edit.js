"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}$(document).ready(function(){$(".layout-option").click(function(a){a.preventDefault();var b=$(this).data("layout");if($(".layout-option").removeClass("chosen"),$(this).addClass("chosen"),b&&b["spread-column-1"]&&b["spread-column-2"]&&b["spread-column-3"]){var c=function(a,b){a.hasClass("box")?b+=" box":b,a.css({opacity:1,background:"var(--color-lane)"}).removeClass().addClass(function(){var a=$(this);setTimeout(function(){a.addClass(b).css({opacity:1,background:""})},200)})};c($("#spread-column-1"),b["spread-column-1"]),c($("#spread-column-2"),b["spread-column-2"]),c($("#spread-column-3"),b["spread-column-3"])}enableSave()}),$(".box-toggle").change(function(){$("#".concat($(this).data("boxtarget"))).toggleClass("box"),enableSave()});var a={paragraph:{inlineToolbar:["bold","italic","inlineCode"]},header:{class:Header,config:{minHeader:2,maxHeader:6,defaultLevel:2}},list:{class:List,inlineToolbar:["bold","italic","inlineCode","outdent","indent","styleToggle"]},inlineCode:{class:InlineCode},indent:{class:ListIndent},outdent:{class:ListOutdent},styleToggle:{class:ListStyleToggle},image:{class:ImageTool,config:{field:"fileupload",endpoints:{byFile:"/api/v1/file-upload/create/one",byUrl:"/api/v1/file-upload/create/one"},additionalRequestData:{via:"editorjs"}}},table:{class:Table,inlineToolbar:["bold","italic"],config:{rows:2,cols:2}},code:{class:CodeTool},embed:{class:Embed,inlineToolbar:!1,config:{services:{youtube:!0}}},checklist:{class:Checklist,inlineToolbar:["bold","italic","inlineCode"]},note:{class:Note,inlineToolbar:["bold","italic","inlineCode"],config:{titlePlaceholder:"Note Title",messagePlaceholder:"Note Message"}},quote:{class:Quote,inlineToolbar:!1,config:{quotePlaceholder:"Enter a Quote",captionPlaceholder:"Enter the Author"}},actionLink:{class:InlineActionLink,inlineToolbar:!1}},b=new EditorJS({holder:"spread-column-1",placeholder:"Column 1...",tools:a,data:window.editorjs_initialize_data.column1}),c=new EditorJS({holder:"spread-column-2",placeholder:"Column 2...",tools:a,data:window.editorjs_initialize_data.column2}),d=new EditorJS({holder:"spread-column-3",placeholder:"Column 3...",tools:a,data:window.editorjs_initialize_data.column3});$("#file").change(function(){if($("#img-changed").val("true"),$("#button-remove-image").show(),$("#img-removed").val("false"),$("#file")&&$("#file")[0]&&$("#file")[0].files&&$("#file")[0].files[0]){var a=new FileReader;a.onload=function(a){$(".section-img").css("background-image","url('".concat(a.target.result,"')"))},a.readAsDataURL($("#file")[0].files[0])}$(".arrow-pulse-down").show(),enableSave()}),$("#button-remove-image").click(function(a){a.preventDefault(),$(".section-img").css("background-image",""),$("#button-remove-image").hide(),$("#img-removed").val("true"),$(".arrow-pulse-down").hide(),enableSave()}),$(".article-heading").on("keyup change paste",function(){$(".breadcrumbs li:last-child > a").text($(".article-heading").text())}),$("#add-tag-input").easyAutocomplete({url:"/api/v1/tag/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#tag").val(JSON.stringify($("#add-tag-input").getSelectedItemData()))}},requestDelay:200}),$("#add-tag-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-tag-input").val().length&&(renderTag(JSON.parse($("#tag").val())),$("#add-tag-input, #tag").val(""))}),$(".tags").on("click",".remove-tag-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-audience-input").easyAutocomplete({url:"/api/v1/audience/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#audience").val(JSON.stringify($("#add-audience-input").getSelectedItemData()))}},requestDelay:200}),$("#add-audience-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-audience-input").val().length&&(renderAudience(JSON.parse($("#audience").val())),$("#add-audience-input, #audience").val(""))}),$(".audience").on("click",".remove-audience-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$("#add-alias-input").easyAutocomplete({url:"/api/v1/alias/get/all",getValue:"title",list:{maxNumberOfElements:2,match:{enabled:!0},onChooseEvent:function(){$("#alias").val(JSON.stringify($("#add-alias-input").getSelectedItemData()))}},requestDelay:200}),$("#add-alias-input").on("keyup",function(a){a.preventDefault(),13==a.which&&$("#add-alias-input").val().length&&(renderAlias(JSON.parse($("#alias").val())),$("#add-alias-input, #alias").val(""))}),$(".alias").on("click",".remove-alias-button",function(a){a.preventDefault(),$(a.target).closest("li").remove(),enableSave()}),$(".button-save").click(function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.preventDefault(),!$(e.currentTarget).hasClass("disabled")){a.next=3;break}return a.abrupt("return",!1);case 3:return f=$(".tags").children("li.tag").map(function(a,b){return $(b).data("tagid")}).toArray(),g=$(".audience").children("li.audience-item").map(function(a,b){return $(b).data("audienceid")}).toArray(),h=$(".alias").children("li.alias-item").map(function(a,b){return $(b).data("aliasid")}).toArray(),i=new FormData,i.append("title",$("#article-title").text()),i.append("idSpreadPhase",$("#phase").val()),i.append("idSpreadLayout",$(".layout-option.chosen").data("layoutid")),a.t0=i,a.t1=JSON,a.next=14,b.save();case 14:return a.t2=a.sent,a.t3=a.t1.stringify.call(a.t1,a.t2),a.t0.append.call(a.t0,"column1",a.t3),a.t4=i,a.t5=JSON,a.next=21,c.save();case 21:return a.t6=a.sent,a.t7=a.t5.stringify.call(a.t5,a.t6),a.t4.append.call(a.t4,"column2",a.t7),a.t8=i,a.t9=JSON,a.next=28,d.save();case 28:for(a.t10=a.sent,a.t11=a.t9.stringify.call(a.t9,a.t10),a.t8.append.call(a.t8,"column3",a.t11),i.append("column1IsBox",$("#column1IsBox").is(":checked")),i.append("column2IsBox",$("#column2IsBox").is(":checked")),i.append("column3IsBox",$("#column3IsBox").is(":checked")),j=!0,k=!1,l=void 0,a.prev=37,m=f[Symbol.iterator]();!(j=(n=m.next()).done);j=!0)o=n.value,i.append("tags[]",o);a.next=45;break;case 41:a.prev=41,a.t12=a["catch"](37),k=!0,l=a.t12;case 45:a.prev=45,a.prev=46,j||null==m.return||m.return();case 48:if(a.prev=48,!k){a.next=51;break}throw l;case 51:return a.finish(48);case 52:return a.finish(45);case 53:for(p=!0,q=!1,r=void 0,a.prev=56,s=g[Symbol.iterator]();!(p=(t=s.next()).done);p=!0)u=t.value,i.append("audiences[]",u);a.next=64;break;case 60:a.prev=60,a.t13=a["catch"](56),q=!0,r=a.t13;case 64:a.prev=64,a.prev=65,p||null==s.return||s.return();case 67:if(a.prev=67,!q){a.next=70;break}throw r;case 70:return a.finish(67);case 71:return a.finish(64);case 72:for(v=!0,w=!1,x=void 0,a.prev=75,y=h[Symbol.iterator]();!(v=(z=y.next()).done);v=!0)A=z.value,i.append("aliases[]",A);a.next=83;break;case 79:a.prev=79,a.t14=a["catch"](75),w=!0,x=a.t14;case 83:a.prev=83,a.prev=84,v||null==y.return||y.return();case 86:if(a.prev=86,!w){a.next=89;break}throw x;case 89:return a.finish(86);case 90:return a.finish(83);case 91:"true"===$("#img-changed").val()&&i.append("fileupload",$("#file")[0].files[0]),i.append("imageRemoved",$("#img-removed").val()),$.ajax({url:$("#update-endpoint").val(),method:$("#update-method").val(),contentType:!1,processData:!1,data:i,success:function(a){disableSave(),a.created?window.location.replace("/spread/"+a.spread.id):$("#toast-save-success").addClass("show")},error:function(){$("#toast-save-error").addClass("show")}});case 94:case"end":return a.stop();}},a,null,[[37,41,45,53],[46,,48,52],[56,60,64,72],[65,,67,71],[75,79,83,91],[84,,86,90]])}));return function(){return a.apply(this,arguments)}}()),$(".article, .console-modal").on("keyup change paste",":input, [contenteditable=true]",function(){$("#article-title").text().length?enableSave():disableSave()}),$(".article").on("click",".ce-settings__plugin-zone *, .ce-settings__default-zone *",function(){$("#article-title").text().length?enableSave():disableSave()}),$("#button-generate-preview").click(function(a){a.preventDefault(),$.ajax({url:"/api/v1/preview/create/one",method:"POST",data:{entity:"spread",entityID:$("#spread-id").val()},success:function(a){$("#preview-link").val(a.link),$("#modal-preview").foundation("open")},error:function(a){console.error(a)}})})});var renderTag=function(a){var b=!1,c=!1;$(".tags").children(".tag").each(function(){return $(this).data("tagid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(tagToDOM(a)),!1):void 0}),b||c||($(".tags").children(".tag").length?$(".tags").children(".tag").last().before(tagToDOM(a)):$(".tags").children().last().before(tagToDOM(a)))},tagToDOM=function(a){return"<li data-tagid=\"".concat(a.id,"\" class=\"tag\"><a href=\"#\">").concat(a.title,"<button class='remove-tag-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderAudience=function(a){var b=!1,c=!1;$(".audience").children(".audience-item").each(function(){return $(this).data("audienceid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(audienceToDOM(a)),!1):void 0}),b||c||($(".audience").children(".audience-item").length?$(".audience").children(".audience-item").last().before(audienceToDOM(a)):$(".audience").children().last().before(audienceToDOM(a)))},audienceToDOM=function(a){return"<li data-audienceid=\"".concat(a.id,"\" class=\"audience-item\"><a href=\"#\">").concat(a.title,"<button class='remove-audience-button'><i class='fas fa-times-circle'></i></button></a></li>")},renderAlias=function(a){var b=!1,c=!1;$(".alias").children(".alias-item").each(function(){return $(this).data("aliasid")==a.id?(c=!0,!1):$(this).children("a").text()>a.title?(b=!0,$(this).before(aliasToDOM(a)),!1):void 0}),b||c||($(".alias").children(".alias-item").length?$(".alias").children(".alias-item").last().before(aliasToDOM(a)):$(".alias").children().last().before(aliasToDOM(a)))},aliasToDOM=function(a){return"<li data-aliasid=\"".concat(a.id,"\" class=\"alias-item\"><a href=\"#\">").concat(a.title,"<button class='remove-alias-button'><i class='fas fa-times-circle'></i></button></a></li>")},enableSave=function(){$(".button-save").removeClass("disabled")},disableSave=function(){$(".button-save").addClass("disabled")};