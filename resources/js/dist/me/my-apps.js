"use strict";$(document).ready(function(){$.extend($.expr[":"],{containsi:function(a,b,c){return 0<=(a.textContent||a.innerText||"").toLowerCase().indexOf((c[3]||"").toLowerCase())}});var a=debounce(function(a){a.preventDefault(),doneTyping()},400);$("#filter-apps").on("keyup",a),refreshFavorites(),refreshInstalled(),refreshAvailable(),$(".profile-section-content").on("change",".toggle-heart",function(a){updateFavorite($(a.target).closest(".app").data("appid"),$(a.target).hasClass("checkable"))}),$("#favorite-apps-container, #installed-apps-container").on("click",".button-remove-app",function(a){a.preventDefault(),updateInstallation($(a.target).closest(".app").data("appid"),!1)}),$(".profile-section-content").on("click",".button-add-app",function(a){a.preventDefault(),updateInstallation($(a.target).closest(".app").data("appid"),!0)})});var filterApps=function(){var a=$("#filter-apps").val().toLowerCase();"string"==typeof a&&a.length&&($("#available-apps-container").find(".app").not(":containsi(\"".concat(a,"\")")).hide(),$("#available-apps-container").find(".app").filter(":containsi(\"".concat(a,"\")")).addClass("filtered"))},doneTyping=function(){resetAppsFilter(),filterApps()},resetAppsFilter=function(){$("#available-apps-container").find(".app").show(),$("#available-apps-container").find(".filtered").removeClass("filtered")},debounce=function(a,b){var c;return function(){var d=arguments,e=this;clearTimeout(c),c=setTimeout(function(){return a.apply(e,d)},b)}};function refreshFavorites(){$.ajax({url:"/api/v1/me/app/get/favorites",method:"GET",beforeSend:function(){$("#favorite-apps-container").empty()},success:function(a){a.length||$("#favorite-apps-container").append(renderEmptyFavoritesBox());var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,$("#favorite-apps-container").append(new MyAppCard(f,!0,!0).render())}catch(a){c=!0,d=a}finally{try{b||null==g.return||g.return()}finally{if(c)throw d}}},error:function(a){console.error(a)}})}function refreshInstalled(){$.ajax({url:"/api/v1/me/app/get/installed",method:"GET",beforeSend:function(){$("#installed-apps-container").empty()},success:function(a){a.length||$("#installed-apps-container").append(renderEmptyInstalledBox());var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,$("#installed-apps-container").append(new MyAppCard(f,!0,!1).render())}catch(a){c=!0,d=a}finally{try{b||null==g.return||g.return()}finally{if(c)throw d}}},error:function(a){console.error(a)}})}function refreshAvailable(){$.ajax({url:"/api/v1/me/app/get/available",method:"GET",beforeSend:function(){$("#available-apps-container").empty()},success:function(a){a.length||$("#available-apps-container").append(renderEmptyAvailableBox());var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,$("#available-apps-container").append(new MyAppCard(f,!1,!1).render())}catch(a){c=!0,d=a}finally{try{b||null==g.return||g.return()}finally{if(c)throw d}}},error:function(a){console.error(a)}})}function updateFavorite(a,b){setTimeout(function(){sendUpdateFavorites(a,b)},800)}function sendUpdateFavorites(a,b){setTimeout(function(){$.ajax({url:"/api/v1/me/app/set-favorite/one",method:"PATCH",data:{id:a,favorite:b},success:function(c){$(".app[data-appid='".concat(a,"'")).siblings().length||($(".app[data-appid='".concat(a,"'")).closest("#favorite-apps-container").length?$("#favorite-apps-container").append(renderEmptyFavoritesBox()):$("#installed-apps-container").append(renderEmptyInstalledBox())),b?($(".app[data-appid='".concat(a,"'")).remove(),$("#favorite-apps-container").append(new MyAppCard(c.app,!0,!0).render())):($(".app[data-appid='".concat(a,"'")).remove(),$("#installed-apps-container").append(new MyAppCard(c.app,!0,!1).render())),$(".app[data-appid='".concat(a,"'")).siblings(".empty").remove()},error:function(a){console.error(a)}})},100)}function updateInstallation(a,b){if(b){var c=$(".app[data-appid='".concat(a,"'"));c.find("div.img").removeAttr("style").html(MyAppCard.renderSpinner()),c.find("a.action").remove(),c.append(MyAppCard.renderProgressBar(a)),function c(d){setTimeout(function(){d+=90>d?Math.ceil(Math.random()*Math.min(d,16)):3,$("#install-progress-".concat(a)).children(".progress-meter").width("".concat(d,"%")),100>d?c(d):sendUpdateInstallation(a,b)},Math.max(400/d,50))}(1)}else sendUpdateInstallation(a,b)}function sendUpdateInstallation(a,b){setTimeout(function(){$.ajax({url:"/api/v1/me/app/set-installed/one",method:"POST",data:{id:a,installed:b},success:function(c){$(".app[data-appid='".concat(a,"'")).siblings().length||($(".app[data-appid='".concat(a,"'")).closest("#favorite-apps-container").length?$("#favorite-apps-container").append(renderEmptyFavoritesBox()):$(".app[data-appid='".concat(a,"'")).closest("#installed-apps-container").length?$("#installed-apps-container").append(renderEmptyInstalledBox()):$("#available-apps-container").append(renderEmptyAvailableBox())),b?($(".app[data-appid='".concat(a,"'")).remove(),$("#installed-apps-container").append(new MyAppCard(c.app,!0,!1).render())):($(".app[data-appid='".concat(a,"'")).remove(),$("#available-apps-container").append(new MyAppCard(c.app,!1,!1).render())),$(".app[data-appid='".concat(a,"'")).siblings(".empty").remove()},error:function(a){console.error(a)}})},100)}function renderEmptyFavoritesBox(){return"<div class=\"cell medium-12 my-apps empty\">\n    <p>You can add shortcuts to your frequently used Apps & Utilities</p>\n  </div>"}function renderEmptyInstalledBox(){return"<div class=\"cell medium-12 my-apps empty\">\n    <p>You can install Apps & Utilities to have easy access to them through your profile.</p>\n  </div>"}function renderEmptyAvailableBox(){return"<div class=\"cell medium-12 my-apps empty\">\n    <p>There are no available Apps & Utilities for you to install.</p>\n  </div>"}