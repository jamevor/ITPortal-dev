"use strict";$(document).ready(function(){$.extend($.expr[":"],{containsi:function(a,b,c){return 0<=(a.textContent||a.innerText||"").toLowerCase().indexOf((c[3]||"").toLowerCase())}});var a=debounce(function(a){a.preventDefault(),doneTyping()},400);$("#filter-apps").on("keyup",a),$.ajax({url:"/api/v1/app/get/all",method:"GET",success:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,$("#app-marketplace-container").append(new MyAppCard(f,f.isInstalled,f.isFavorite,f.isUserLoggedIn).render())}catch(a){c=!0,d=a}finally{try{b||null==g.return||g.return()}finally{if(c)throw d}}},error:function(a){console.error(a)}}),$("#app-marketplace-container").on("change",".toggle-heart",function(a){updateFavorite($(a.target).closest(".app").data("appid"),$(a.target).hasClass("checkable"))}),$("#app-marketplace-container").on("click",".button-remove-app",function(a){a.preventDefault(),updateInstallation($(a.target).closest(".app").data("appid"),!1)}),$("#app-marketplace-container").on("click",".button-add-app",function(a){a.preventDefault(),updateInstallation($(a.target).closest(".app").data("appid"),!0)})});var filterApps=function(){var a=$("#filter-apps").val().toLowerCase();"string"==typeof a&&a.length&&($("#app-marketplace-container").find(".app").not(":containsi(\"".concat(a,"\")")).hide(),$("#app-marketplace-container").find(".app").filter(":containsi(\"".concat(a,"\")")).addClass("filtered"))},doneTyping=function(){resetAppsFilter(),filterApps()},resetAppsFilter=function(){$("#app-marketplace-container").find(".app").show(),$("#app-marketplace-container").find(".filtered").removeClass("filtered")},debounce=function(a,b){var c;return function(){var d=arguments,e=this;clearTimeout(c),c=setTimeout(function(){return a.apply(e,d)},b)}};function updateFavorite(a,b){setTimeout(function(){sendUpdateFavorites(a,b),$(".app[data-appid='".concat(a,"'")).find(".toggle-heart").toggleClass("checkable")},800)}function sendUpdateFavorites(a,b){setTimeout(function(){$.ajax({url:"/api/v1/me/app/set-favorite/one",method:"PATCH",data:{id:a,favorite:b},success:function(){},error:function(a){console.error(a)}})},100)}function updateInstallation(a,b){if(b){var c=$(".app[data-appid='".concat(a,"'"));c.find("div.img").removeAttr("style").html(MyAppCard.renderSpinner()),c.find("a.action").remove(),c.append(MyAppCard.renderProgressBar(a)),function c(d){setTimeout(function(){d+=90>d?Math.ceil(Math.random()*Math.min(d,16)):3,$("#install-progress-".concat(a)).children(".progress-meter").width("".concat(d,"%")),100>d?c(d):sendUpdateInstallation(a,b)},Math.max(400/d,50))}(1)}else sendUpdateInstallation(a,b)}function sendUpdateInstallation(a,b){setTimeout(function(){$.ajax({url:"/api/v1/me/app/set-installed/one",method:"POST",data:{id:a,installed:b},success:function(c){$(".app[data-appid='".concat(a,"'")).replaceWith(new MyAppCard(c.app,b,!1,c.app.isUserLoggedIn).render())},error:function(a){console.error(a)}})},100)}