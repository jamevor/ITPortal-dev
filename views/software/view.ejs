<%- include('../partials/api/editorjsToHTML.ejs'); %>

<%
const endpoint = locals.software ? '/api/v1/software/update/one/' + software.id : '/api/v1/software/create/one';
const method = locals.software ? 'PUT' : 'POST';

let contentEditable = locals.edit ? "contenteditable=true" : "";
%>
<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
  <%- include('../partials/header.ejs'); %>
  <%- include('../partials/datatables.ejs'); %>
  <script type='text/javascript' src='/js/pages/software/view.js' defer></script>
  <% if (locals.edit) { %>
    <%- include('../partials/easy-autocomplete.ejs'); %>
    <%- include('../partials/editorjs.ejs'); %>
    <script type="text/javascript">
      window.editorjs_initialize_data = {};
      <% if (locals.software && software.descriptionLong && software.descriptionLong.length) { %>
        window.editorjs_initialize_data.descriptionLong = <%- software.descriptionLong %>;
      <% } else { %>
        window.editorjs_initialize_data.descriptionLong = {};
      <% } %>
    </script>
    <script type='text/javascript' src='/js/console/EntityGroupsUtility.js' defer></script>
    <script type='text/javascript' src='/js/console/software/edit.js' defer></script>
  <% } %>
</head>
<%- include('../partials/layout/top.ejs'); %>

<% if (locals.edit) { %>
  <% if (locals.software) { %>
    <input type='hidden' id='software-id' name='softwareID' value='<%= software.id %>'>
  <% } %>
  <input type='hidden' id='update-endpoint' name='updateEndpoint' value='<%= endpoint %>'>
  <input type='hidden' id='update-method' name='updateMethod' value='<%= method %>'>
<% } %>


  <div class="grid-container fluid swim-lane article" data-size-control='{"display": true, "thiccener":true, "thiccener-item":"grid-container"}'>
    <div class="grid-container">


      <nav aria-label="You are here:" role="navigation">
        <ul class="breadcrumbs">
          <li><a href="/"><span class="show-for-sr">Home </span><i class="fa-fw fas fa-home"></i></a></li>
          <li><a href="/All-Software">Software Library</a></li>
          <li>
            <a href='#'>
              <span class="show-for-sr">Current: </span> <%= locals.software ? software.title : '' %>
            </a>
          </li>
        </ul>
      </nav>



      <div class="grid-x grid-margin-x align-justify">
        <div class="cell small-12 medium-8 large-7 two-col-content">
        <div class="cell small-9 medium-10 large-11">
          <h1 id="article-title" class="article-heading" <%= contentEditable %> <%- locals.edit ? 'placeholder="Software Title"' : '' %>><%= locals.software ? software.title : '' %></h1>
          <% if (locals.edit || (locals.software && software.descriptionShort)) { %>
            <p id="article-summary" class="article-summary" <%= contentEditable %> <%- locals.edit ? 'placeholder="Short Description"' : '' %>><%- locals.software ? software.descriptionShort : '' %></p>
          <% } %>
        </div>
            

            
            <div class="article-body software-body">
              <% const softwareDescriptionLong = locals.software && software.descriptionLong ? editorjsToHTML(software.descriptionLong) : ''; %>
              <% if (softwareDescriptionLong && softwareDescriptionLong.length || locals.edit) { %>
                <h2>About</h2>
                <% if (locals.edit) { %>
                  <div id="descriptionLong"></div>
                <% } else { %>
                  <%- softwareDescriptionLong %>
                <% } %>
              <% } %>
            

              <% if (locals.software && (software.isLicensed || software.isCLA || software.isSCCM || software.useWPI || software.usePersonal) || locals.edit) { %>
                <h3>Using This Software</h3>
                <% if (!locals.edit) { %>
                  <div class="boolean-attributes grid-x grid-margin-x small-up-1 medium-up-2 large-up-2">
                      <%- software.isLicensed ? '<div class="cell"><i class="far fa-fw fa-key"></i> <span>Academic License</span></div>' : '' %>
                      <%- software.isCLA ? '<div class="cell"><i class="far fa-fw fa-shopping-cart"></i> <span>Available in Online Store</span></div>' : '' %>
                      <%- software.useWPI ? '<div class="cell"><i class="far fa-fw fa-briefcase"></i> <span>For use on WPI Devices</span></div>' : '' %>
                      <%- software.usePersonal ? '<div class="cell"><i class="far fa-fw fa-user"></i> <span>Install on Personal Devices</span></div>' : '' %>
                      <%- software.isSCCM ? '<div class="cell"><i class="far fa-fw fa-download"></i> <span>Available through Software Center</span></div>' : '' %>
                      <%- software.researchLicense ? '<div class="cell"><i class="far fa-fw fa-flask"></i> <span>Research License</span></div>' : '' %>
                      <%- software.availablePublicLabs ? '<div class="cell"><i class="far fa-fw fa-door-open"></i> <span>Available in Public Computer Lab</span></div>' : '' %>
                      <%- software.availableTerminalServer ? '<div class="cell"><i class="far fa-fw fa-server"></i> <span>Available on Terminal Server</span></div>' : '' %>
                      <%- software.availableVDI ? '<div class="cell"><i class="far fa-fw fa-browser"></i> <span>Available on VDI</span></div>' : '' %>
                      <%- software.availableSplashtop ? '<div class="cell"><i class="far fa-fw fa-network-wired"></i> <span>Available through Splashtop</span></div>' : '' %>
                      <%- software.usaOnly ? '<div class="cell"><i class="far fa-fw fa-globe-americas"></i> <span>Not allowed for use outside of U.S.</span></div>' : '' %>
                  </div>
                  <% } else { %>
                    <div class="grid-x grid-margin-x small-up-1 medium-up-2 large-up-2 config-lane">
                      <div class='cell'>
                        <p style='margin-bottom:0'>Academic License</p>
                        <div class="switch">
                          <input class="switch-input" id="isLicensed" type="checkbox" name="isLicensed" <%- locals.software && software.isLicensed ? 'checked' : '' %>>
                          <label class="switch-paddle" for="isLicensed">
                            <span class='show-for-sr'>Academic License</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available in Online Store</p>
                        <div class="switch">
                          <input class="switch-input" id="isCLA" type="checkbox" name="isCLA" <%- locals.software && software.isCLA ? 'checked' : '' %>>
                          <label class="switch-paddle" for="isCLA">
                            <span class='show-for-sr'>Available in Online Store</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>For use on WPI Devices</p>
                        <div class="switch">
                          <input class="switch-input" id="useWPI" type="checkbox" name="useWPI" <%- locals.software && software.useWPI ? 'checked' : '' %>>
                          <label class="switch-paddle" for="useWPI">
                            <span class='show-for-sr'>For use on WPI Devices</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Install on Personal Devices</p>
                        <div class="switch">
                          <input class="switch-input" id="usePersonal" type="checkbox" name="usePersonal" <%- locals.software && software.usePersonal ? 'checked' : '' %>>
                          <label class="switch-paddle" for="usePersonal">
                            <span class='show-for-sr'>Install on Personal Devices</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available through Software Center</p>
                        <div class="switch">
                          <input class="switch-input" id="isSCCM" type="checkbox" name="isSCCM" <%- locals.software && software.isSCCM ? 'checked' : '' %>>
                          <label class="switch-paddle" for="isSCCM">
                            <span class='show-for-sr'>Available through Software Center</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Research License</p>
                        <div class="switch">
                          <input class="switch-input" id="researchLicense" type="checkbox" name="researchLicense" <%- locals.software && software.researchLicense ? 'checked' : '' %>>
                          <label class="switch-paddle" for="researchLicense">
                            <span class='show-for-sr'>Research License</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available in Public Computer Lab</p>
                        <div class="switch">
                          <input class="switch-input" id="availablePublicLabs" type="checkbox" name="availablePublicLabs" <%- locals.software && software.availablePublicLabs ? 'checked' : '' %>>
                          <label class="switch-paddle" for="availablePublicLabs">
                            <span class='show-for-sr'>Available in Public Computer Lab</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available on Terminal Server</p>
                        <div class="switch">
                          <input class="switch-input" id="availableTerminalServer" type="checkbox" name="availableTerminalServer" <%- locals.software && software.availableTerminalServer ? 'checked' : '' %>>
                          <label class="switch-paddle" for="availableTerminalServer">
                            <span class='show-for-sr'>Available on Terminal Server</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available on VDI</p>
                        <div class="switch">
                          <input class="switch-input" id="availableVDI" type="checkbox" name="availableVDI" <%- locals.software && software.availableVDI ? 'checked' : '' %>>
                          <label class="switch-paddle" for="availableVDI">
                            <span class='show-for-sr'>Available on VDI</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Available through Splashtop</p>
                        <div class="switch">
                          <input class="switch-input" id="availableSplashtop" type="checkbox" name="availableSplashtop" <%- locals.software && software.availableSplashtop ? 'checked' : '' %>>
                          <label class="switch-paddle" for="availableSplashtop">
                            <span class='show-for-sr'>Available through Splashtop</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                      <div class='cell'>
                        <p style='margin-bottom:0'>Not allowed outside of U.S.</p>
                        <div class="switch">
                          <input class="switch-input" id="usaOnly" type="checkbox" name="usaOnly" <%- locals.software && software.usaOnly ? 'checked' : '' %>>
                          <label class="switch-paddle" for="usaOnly">
                            <span class='show-for-sr'>Not allowed outside of U.S.</span>
                            <span class='switch-active'>Yes</span>
                            <span class='switch-inactive'>No</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  <% } %>
                <% } %>


                <% if ((locals.software && (software.installWho || software.requirements || software.requesting || software.installPointPublic)) || locals.edit) { %>

                  <h3>Install</h3>

                  <% if (locals.software && software.installWho || locals.edit) { %>
                    <h4>Who can Install this Software?</h4>
                    <p id='installWho' <%= contentEditable %> <%- locals.edit ? 'placeholder="Who can install this Software?"' : '' %>><%= locals.software &&  software.installWho ? software.installWho : '' %></p>
                  <% } %>

                  <% if (locals.software && software.requirements || locals.edit) { %>
                    <h4>Requirements</h4>
                    <p id='requirements' <%= contentEditable %> <%- locals.edit ? 'placeholder="Requirements"' : '' %>><%= locals.software &&  software.requirements ? software.requirements : '' %></p>
                  <% } %>

                  <% if (locals.software && software.requesting || locals.edit) { %>
                    <h4>Requesting this Software</h4>
                    <p id='requesting' <%= contentEditable %> <%- locals.edit ? 'placeholder="Requesting this Software"' : '' %>><%= locals.software &&  software.requesting ? software.requesting : '' %></p>
                  <% } %>

                  <% if (locals.software && software.installPointPublic || locals.edit) { %>
                    <h4>Install Location</h4>
                    <div class='input-group'>
                      <input type='text' id="installPointPublic" value="<%= locals.software && software.installPointPublic ? software.installPointPublic : '' %>" class='input-group-field copy-text' <%- locals.edit ? '' : 'readonly' %>>
                      <button id='button-copy-install-point-public' class='input-group-button copy-button'><i class='far fa-copy'></i></button>
                    </div>
                  <% } %>
                  
                <% } %>

            </div>

            <% if (locals.articles && articles.length || locals.edit) { %>
              <div class="swim-lane">
                <h2>Related Articles</h2>
                <div class="grid-container full">
                <% if (locals.edit) { %>
                  <input id='article' type='hidden' name='article'>
                  <div class="input-group">
                    <input class='ez-input input-group-field' type='text' id='add-article-input'>
                    <div class="input-group-button">
                      <button id="add-article-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
                    </div>
                  </div>
                <% } %>
                  <ul class="card-list no-indent grid-x grid-margin-x small-up-1 medium-up-2 large-up-2 article-cards-wrapper">
                  <% if (locals.articles && articles && articles.length) { %>
                    <% for (const article of articles) { %>
                      <%- include('../partials/components/article-card.ejs', {
                        article,
                        edit: locals.edit
                      }); %>
                    <% } %>
                  <% } %>
                  </ul>

                </div>
              </div>
            <% } %>

            <%

            const allServers = [];

            if (locals.software && !locals.edit) {
              if (servers && servers.length) {
                allServers.push(...servers);
              }
              if (packages && packages.length) {
                for (let package of packages) {
                  if (package.servers && package.servers.length) {
                    allServers.push(...package.servers);
                  }
                }
              }
            }

            const allServersFiltered = allServers.filter((element, index, array) => {
              return array.findIndex(element_ => element_.id === element.id) === index;
            });

          %>

          <% if (locals.software && allServersFiltered && allServersFiltered.length || locals.edit) { %>
            <div class="swim-lane">
              <h2>Servers With This Software</h2>
              <% if (locals.edit) { %>
                  <input type="hidden" id="server" name="server">
                  <label for="add-server-input">Server Title</label>
                  <div class="input-group">
                    <input type="text" id="add-server-input" name="add-server-input" class="input-group-field ez-input">
                    <div class="input-group-button">
                      <button id="add-server-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
                    </div>
                  </div>
              <% } %>
              <table id='serversTable' class='table'>
                <thead>
                  <tr>
                    <th class='table-hidden'>ID</th>
                    <th>Server</th>
                    <th>Hostname</th>
                    <% if (locals.edit) { %>
                      <th>Remove</th>
                    <% } %>
                  </tr>
                </thead>
                <tbody>
                  <% if (locals.edit && locals.servers && servers && servers.length) { %>
                    <% for (const server_ of servers) { %>
                      <tr>
                        <td><%= server_.id %></td>
                        <td><a href="#"><%= server_.title %></a></td>
                        <td><%= server_.host %></td>
                        <% if (locals.edit) { %>
                          <td><button class='button-remove-server'><i class='fas fa-unlink'></i> Remove</button></td>
                        <% } %>
                      </tr>
                    <% } %>
                  <% } else if (locals.software && !locals.edit) { %>
                    <% for (const server_ of allServersFiltered) { %>
                      <tr>
                        <td><%= server_.id %></td>
                        <td><a href="/server/<%= server_.id %>"><%- server_.title %></a></td>
                        <td><a href="/server/<%= server_.id %>"><%- server_.host %></a></td>
                      </tr>
                    <% } %>
                  <% } %>
                </tbody>
              </table>
            </div>
          <% } %>


            <%

            const allLocations = [];

            if (locals.software && !locals.edit) {
              if (locations && locations.length) {
                allLocations.push(...locations);
              }
              if (packages && packages.length) {
                for (let package of packages) {
                  if (package.locations && package.locations.length) {
                    allLocations.push(...package.locations);
                  }
                }
              }
            }

            const allLocationsFiltered = allLocations.filter((element, index, array) => {
              return array.findIndex(element_ => element_.id === element.id) === index;
            });


          
          %>
            
            <% if (locals.software && allLocationsFiltered && allLocationsFiltered.length || locals.edit) { %>
              <div class="swim-lane">
                <h2>Locations With This Software</h2>
                <% if (locals.edit) { %>
                    <input type="hidden" id="location" name="location">
                    <label for="add-location-input">Location Title</label>
                    <div class="input-group">
                      <input type="text" id="add-location-input" name="add-location-input" class="input-group-field ez-input">
                      <div class="input-group-button">
                        <button id="add-location-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
                      </div>
                    </div>
                <% } %>
                <table id='locationsTable' class='table'>
                  <thead>
                    <tr>
                      <th class='table-hidden'>ID</th>
                      <th class='table-hidden'>Abbr</th>
                      <th>Building</th>
                      <th>Location</th>
                      <th class='table-hidden'>Room</th>
                      <th>Type</th>
                      <% if (locals.edit) { %>
                        <th>Remove</th>
                      <% } %>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (locals.edit && locals.software && locals.locations && locations.length) { %>
                      <% for (const location of locations) { %>
                        <tr>
                          <td><%= location.id %></td>
                          <td><%= location.building && location.building.abbr ? location.building.abbr : '' %></td>
                          <td><a href="#"><%= location.building ? location.building.title : '' %></a></td>
                          <td><a href="#"><%= location.title %></a></td>
                          <td><%= location.room %></td>
                          <td class='text-capitalize'><%= location.locationType ? location.locationType.title : '' %></td>
                          <% if (locals.edit) { %>
                            <td><button class='button-remove-location'><i class='fas fa-unlink'></i> Remove</button></td>
                          <% } %>
                        </tr>
                      <% } %>
                    <% } else if (locals.software && !locals.edit) { %>
                      <% for (const location of allLocationsFiltered) { %>
                        <tr>
                          <td><%= location.id %></td>
                          <td><%= location.building && location.building.abbr ? location.building.abbr : '' %></td>
                          <td><a href="/building/<%= location.building ? location.building.id : '' %>"><%= location.building ? location.building.title : '' %></a></td>
                          <td><a href="<%= locals.edit ? '#' : '/location/' + location.id + '' %>"><%= location.title %></a></td>
                          <td><%= location.room %></td>
                          <td class='text-capitalize'><%= location.locationType ? location.locationType.title : '' %></td>
                          <% if (locals.edit) { %>
                            <td><button class='button-remove-location'><i class='fas fa-unlink'></i> Remove</button></td>
                          <% } %>
                        </tr>
                      <% } %>
                    <% } %>
                  </tbody>
                </table>
              </div>
            <% } %>


        </div>



        <div class="cell small-12 medium-4 two-col-sidebar">

          <% if (locals.edit) { %>

            <input type="hidden" id='is-access-restricted' value="<%- locals.software && software.accessRestricted ? 'true' : 'false' %>">
            <input type="hidden" id='can-remove-groups' value="<%- locals.canRemoveGroups %>">
            <div class="box card" id="egu"></div>

            <p style='margin-bottom:0'>Supported</p>
            <div class="switch">
              <input class="switch-input" id="supported" type="checkbox" name="supported" <%- locals.software && software.supported ? 'checked' : '' %>>
              <label class="switch-paddle" for="supported">
                <span class='show-for-sr'>License Required</span>
                <span class='switch-active'>Yes</span>
                <span class='switch-inactive'>No</span>
              </label>
            </div>

          <% } %>
          <div class="box">   
            <div class="news-status-card" style="background-color:<%= locals.software && software.supported ? 'var(--color-bright-2)' : 'var(--color-bright-3)' %>">
              <div class="news-status-icon"><i class="fas <%= locals.software && software.supported ? 'fa-check-circle' : 'fa-exclamation-circle' %> fa-2x"></i></div>
              <div class="news-status-title"><%= locals.software && software.supported ? 'WPI Supported' : 'Best Effort Support' %></div>  
            </div>
          </div>

          
          <% if (locals.software && (software.publisher || software.releaseYear || software.version || software.softwareOs) || locals.edit) { %>
            <div class="box card">
              <h2>Software Information</h2>

              <% if (locals.software && software.publisher || locals.edit) { %>
                <h3>Publisher</h3>
                <p id='publisher' <%= contentEditable %> <%- locals.edit ? 'style="min-height:4em;" placeholder="Publisher"' : '' %>><%= locals.software ? software.publisher : '' %></p>
              <% } %>

              <% if (locals.software && software.releaseYear || locals.edit) { %>
                <h3>Release Year</h3>
                <% if (locals.edit) { %>
                  <input type='number' id='releaseYear' name='releaseYear' value="<%= locals.software && software.releaseYear ? software.releaseYear : '' %>">
                <% } else { %>
                  <p><%= software.releaseYear %></p>
                <% } %>
              <% } %>

              <% if (locals.software && software.version || locals.edit) { %>
                <h3>Version</h3>
                <p id='version' <%= contentEditable %> <%- locals.edit ? 'style="min-height:4em;" placeholder="Version"' : '' %>><%= locals.software ? software.version : '' %></p>
              <% } %>

              <% if (locals.software && software.softwareOs && software.softwareOs.length || locals.edit) { %>
                <h3>OS</h3>
                <ul class="os">
                  <% if (locals.software && software.softwareOs && software.softwareOs.length) { %>
                    <% for (const os of software.softwareOs) { %>
                      <li data-softwareosid="<%= os.id %>" class="softwareos-item"><a href="#"><i title="<%= os.title %>" class="fab fa-lg <%= os.icon %>"></i><% if (locals.edit) { %> <button class='remove-softwareos-button'><i class='fas fa-times-circle'></i></button> <% } %></a></li>
                    <% } %>
                  <% } %>                

                  <% if (locals.edit) { %>
                    <li data-softwareosid=""><input type='text' id='add-softwareos-input'></li>
                  <% } %>
                </ul>
                <% if (locals.edit) { %>
                  <input type="hidden" id="softwareos" name="softwareos">
                <% } %>
              <% } %>

              
            </div>
          <% } %>

          <% if(locals.software && software.actions && software.actions.length || locals.edit) { %>
            <div class="box">
                <h2>Actions</h2>
                <% if (locals.edit) { %>
                  <div id="add-action-box" class="link-cards">
                    <input type="hidden" id="action" name="action">
                    <label for="actionTitle">Action Title</label>
                    <div class="input-group">
                      <input type="text" id="actionTitle" name="actionTitle" class="add-action-input input-group-field ez-input">
                      <div class="input-group-button">
                        <button id="add-action-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
                      </div>
                    </div>
                  </div>
                <% } %>
                <ul class="link-cards" id="link-cards-action">
                <% if (locals.software && software.actions.length) { %>
                  <% for (const action of software.actions) { %>
                    <li data-actionid="<%= action.id %>"><a class="<%= action.actionType.title %>" target="<%= locals.edit ? '_self' : action.actionType.target %>" href="<%= locals.edit ? '#' : `${action.actionType.URIscheme}${action.link}` %>" title="<%- action.title %>"><%- action.title %><% if (locals.edit) { %> <button class='remove-action-button'><i class='fas fa-times-circle'></i></button> <% } %></a></li>
                  <% } %>
                <% } %>
                </ul>
            </div>
          <% } %>


          <% if(locals.software && (software.createdAt || software.updatedAt) || locals.edit) { %>
            <div class="box card">
              <h2>Details</h2>
              <p><strong>Created:</strong> <%= locals.software && software.createdAt ? moment(software.createdAt).format('ll') : '' %></p>
              <p><strong>Modified:</strong> <%= locals.software && software.updatedAt ? moment(software.updatedAt).format('ll') : '' %></p>
            </div>
          <% } %>


          <% if (locals.software && (software.tags.length || software.aliases.length || software.audiences.length) || locals.edit) { %>
            <div class="box card">
              <h2>Metadata</h2>
              <% if (locals.software && software.tags.length || locals.edit) { %>
                <h3>Tags</h3>
                <ul class="tags">
                  <% if (locals.software && software.tags.length) { %>
                    <% software.tags.forEach(function(tag){ %>
                      <li data-tagid="<%= tag.id %>" class='tag'><a href="<%= locals.edit ? '#' : '/tag/' + tag.id %>"><%- tag.title %><% if (locals.edit) { %> <button class='remove-tag-button'><i class='fas fa-times-circle'></i></button> <% } %></a></li>
                    <% }); %>
                  <% } %>
                  <% if (locals.edit) { %>
                    <li data-tagid=""><input type='text' id='add-tag-input'></li>
                  <% } %>
                </ul>
                <% if (locals.edit) { %>
                  <input type="hidden" id="tag" name="tag">
                <% } %>
              <% } %>
              <% if (locals.software && software.audiences.length || locals.edit) { %>
                <h3>Audience</h3>
                <ul class="audience">
                  <% if (locals.software && software.audiences.length) { %>
                    <% software.audiences.forEach(function(audience){ %>
                      <li data-audienceid="<%= audience.id %>" class="audience-item"><a href="<%= locals.edit ? '#' : '/audience/' + audience.id %>"><%- audience.title %><% if (locals.edit) { %> <button class='remove-audience-button'><i class='fas fa-times-circle'></i></button> <% } %></a></li>
                    <% }); %>
                  <% } %>
                  <% if (locals.edit) { %>
                    <li data-audienceid=""><input type='text' id='add-audience-input'></li>
                  <% } %>
                </ul>
                <% if (locals.edit) { %>
                  <input type="hidden" id="audience" name="audience">
                <% } %>
              <% } %>
              <% if (locals.software && software.aliases.length || locals.edit) { %>
                <h3>Alias</h3>
                <ul class="alias">
                  <% if (locals.software && software.aliases.length) { %>
                    <% software.aliases.forEach(function(alias){ %>
                      <li data-aliasid="<%= alias.id %>" class="alias-item"><a href="<%= locals.edit ? '#' : '/alias/' + alias.id %>"><%- alias.title %><% if (locals.edit) { %> <button class='remove-alias-button'><i class='fas fa-times-circle'></i></button> <% } %></a></li>
                    <% }); %>
                  <% } %>
                  <% if (locals.edit) { %>
                    <li data-aliasid=""><input type='text' id='add-alias-input'></li>
                  <% } %>
                </ul>
                <% if (locals.edit) { %>
                  <input type="hidden" id="alias" name="alias">
                <% } %>
              <% } %>
            </div>
          <% } %>

          <% if (locals.canEdit) { %>
            <div class="box card">
              <h2>Admin</h2>
              <ul class="link-cards no-icon">
                <% if (!locals.edit && locals.software && software.softwarePhase) { %>
                  <li><span class='text'>Current Phase: <%= software.softwarePhase.title %></span></li>
                <% } %>
                <% if (!locals.edit) { %>
                  <li><a href="/console/software/edit/<%= software.id %>"><i class='fal fa-fw fa-edit'></i> Edit</a></li>
                <% } %>
                <% if (locals.software && locals.edit) { %>
                  <li><a href="/software/<%= software.id %>"><i class='fal fa-fw fa-rocket'></i> Go to Software</a></li>
                  <li><a href="#" id='button-generate-preview'><i class='fal fa-fw fa-mask'></i> Generate Preview</a></li>
                <% } %>
                <% if (locals.edit) { %>
                  <li><a data-open="advanced-settings-modal" id="button-advanced-settings"><i class='fal fa-fw fa-cog'></i> Advanced Settings</a></li>
                <% } %>
                <% if (locals.edit && locals.software && software.softwarePhase && !locals.canPublish) { %>
                  <li><a href="#" data-open="modal-submit-for-review"><i class='fal fa-fw fa-glasses'></i> Submit for Review</a></li>
                  <div class="reveal tiny" id="modal-submit-for-review" data-reveal>
                    <h2>Are you sure?</h2>
                    <p>You will not be able to edit this software while it is being reviewed.</p>
                    <a href="#" class="button-confirm bright-2" id="button-submit-for-review">Yes</a>
                    <a href="#" class="button-confirm bright-4" data-close>No</a>
                    <button class="close-button" data-close aria-label="Close modal" type="button">
                      <span aria-hidden="true"><i class='fas fa-fw fa-times'></i></span>
                    </button>
                  </div>
                <% } %>
                <li><a href="/console"><i class='fal fa-fw fa-terminal'></i> Control Panel</a></li>
              </ul>
            </div>
          <% } %>

          

          <%- include('../partials/components/request-help.ejs'); %>

          <%- include('../partials/components/print-share.ejs'); %>

        
        </div>
      </div>
    </div>
  </div>

  <% if (locals.edit) { %>
    <%- include('../partials/components/edit.ejs', {
      entityTitle: 'Software',
      entityID: locals.software && software.id ? software.id : 'New'
    }); %>
    <%

    const toasts = [
      {
        id: 'toast-save-success',
        type: 'success',
        title: 'Success',
        message: 'Software has been saved',
        show: false
      },
      {
        id: 'toast-save-error',
        type: 'error',
        title: 'Whoops',
        message: 'Something went wrong trying to save your software',
        show: false
      }
    ];
    %>
    <%- include('../partials/components/toaster.ejs', { toasts }); %>
  <% } %>

  <% if (locals.edit && locals.software) { %>
    <%- include('../partials/components/preview-modal.ejs'); %>
  <% } %>


  <% if (locals.edit) { %>
  <div class="reveal console-modal" id="advanced-settings-modal" data-reveal data-options="closeOnClick:false;" data-simplebar>
    <ul class="tabs" data-tabs id="advancedSettingsTabs">
      <li class="tabs-title is-active"><a href="#phaseTab" aria-selected="true"><i class='far fa-satellite-dish'></i> State</a></li>
      <li class="tabs-title"><a href="#relationshipsTab"><i class='fas fa-database'></i> Relationships</a></li>
      <li class="tabs-title"><a href="#auditTab"><i class='far fa-history'></i> Audit</a></li>
    </ul>
    <div data-tabs-content="advancedSettingsTabs">
      <div id="phaseTab" class="tabs-panel is-active">
        <% if (locals.canPublish) { %>
          <label for="phase">Phase</label>
          <select name="phase" id="phase" class='title-case'>
          <% for (let phase of phases) { %>
            <option class='title-case' value="<%= phase.id %>" <%= locals.software && software.idSoftwarePhase == phase.id ? 'selected' : '' %>><%= phase.title %></option>
          <% } %>
          </select>
        <% } else { %>
          <input type="hidden" id="phase" value="1">
        <% } %>
      </div>
      <div id="relationshipsTab" class="tabs-panel">
        <div class='relationship-box'>
          <h2>Licenses</h2>
          <input id='license' type='hidden' name='license'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-license-input'>
            <div class="input-group-button">
              <button id="add-license-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 licenses-wrapper">
            <% if (locals.software && software.licenses && software.licenses.length) { %>
              <% for (const license of software.licenses) { %>
                <li data-licenseid="<%= license.id %>" class="license-item related-item"><%= license.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
        <div class='relationship-box'>
          <h2>Packages</h2>
          <input id='package' type='hidden' name='package'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-package-input'>
            <div class="input-group-button">
              <button id="add-package-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 packages-wrapper">
            <% if (locals.software && locals.packages && packages.length) { %>
              <% for (const package of packages) { %>
                <li data-packageid="<%= package.id %>" class="package-item related-item"><%= package.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
        <div class='relationship-box'>
          <h2>Servers</h2>
          <input id='server' type='hidden' name='server'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-server-input'>
            <div class="input-group-button">
              <button id="add-server-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 servers-wrapper">
            <% if (locals.software && locals.servers && servers.length) { %>
              <% for (const server of servers) { %>
                <li data-serverid="<%= server.id %>" class="server-item related-item"><%= server.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
        <div class='relationship-box'>
          <h2>Software Types</h2>
          <input id='softwareType' type='hidden' name='softwareType'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-softwareType-input'>
            <div class="input-group-button">
              <button id="add-softwareType-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 softwareTypes-wrapper">
            <% if (locals.software && software.softwareTypes && software.softwareTypes.length) { %>
              <% for (const softwareType of software.softwareTypes) { %>
                <li data-softwaretypeid="<%= softwareType.id %>" class="softwareType-item related-item"><%= softwareType.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
        <div class='relationship-box'>
          <h2>Related Components</h2>
          <input id='component' type='hidden' name='component'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-component-input'>
            <div class="input-group-button">
              <button id="add-component-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 components-wrapper">
            <% if (locals.software && locals.components && components.length) { %>
              <% for (const component of components) { %>
                <li data-componentid="<%= component.id %>" class="component-item related-item"><%= component.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
        <div class='relationship-box'>
          <h2>Related Services</h2>
          <input id='service' type='hidden' name='service'>
          <div class="input-group">
            <input class='ez-input input-group-field' type='text' id='add-service-input'>
            <div class="input-group-button">
              <button id="add-service-button" class='button-link-item'><i class="fas fa-link"></i> Link</button>
            </div>
          </div>
          <ul class="card-list no-indent grid-x grid-margin-x small-up-2 medium-up-2 large-up-3 services-wrapper">
            <% if (locals.software && locals.services && services.length) { %>
              <% for (const service of services) { %>
                <li data-serviceid="<%= service.id %>" class="service-item related-item"><%= service.title %><button class='remove-related-item-button'><i class='fas fa-times'></i> Remove</button></li>
              <% } %>
            <% } %>
          </ul>
        </div>
      </div>
      <div id="auditTab" class="tabs-panel">
        <h2>Details</h2>
        <p><strong>Date Review By: </strong><%= locals.software && software.dateReviewBy ? moment(software.dateReviewBy).format('ll') : '' %></p>
        <p><strong>Created On: </strong><%= locals.software && software.createdAt ? moment(software.createdAt).format('ll') : '' %></p>
        <p><strong>Created By: </strong><%= locals.software && software.userCreatedBy && software.userCreatedBy.username ? software.userCreatedBy.username : '' %></p>
        <p><strong>Modified On: </strong><%= locals.software && software.updatedAt ? moment(software.updatedAt).format('ll') : '' %></p>
        <p><strong>Last Modified By: </strong><%= locals.software && software.userModifiedBy && software.userModifiedBy.username ? software.userModifiedBy.username : '' %></p>
      </div>
    </div>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true"><i class='far fa-times'></i></span>
    </button>
  </div>
<% } %>

<%- include('../partials/layout/bottom.ejs') %>
</html>
