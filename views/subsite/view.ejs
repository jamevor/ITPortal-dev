<%- include('../partials/api/editorjsToHTML.ejs'); %>

<%
const endpoint = locals.subsite ? '/api/v1/subsite/update/one/' + subsite.id : '/api/v1/subsite/create/one';
const method = locals.subsite ? 'PUT' : 'POST';

let contentEditable = locals.edit ? "contenteditable=true" : "";
%>
<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
  <%- include('../partials/header.ejs'); %>
  <% if (!locals.edit) { %>
    <%- include('../partials/flickity.ejs'); %>
    <script type='text/javascript' src='/js/components/NewsCard.js' defer></script>
    <script type='text/javascript' src='/js/components/CarouselCell.js' defer></script>
    <script type='text/javascript' src='/js/pages/subsite/view.js' defer></script>
    <% } %>
    <% if (locals.edit) { %>
    <%- include('../partials/datatables.ejs'); %>
    <%- include('../partials/dragula.ejs'); %>
    <%- include('../partials/easy-autocomplete.ejs'); %>
    <script type='text/javascript' src='/js/console/EntityGroupsUtility.js' defer></script>
    <script type='text/javascript' src='/js/console/subsite/edit.js' defer></script>
  <% } %>
  <style>
    .subsite.article.edit{
      padding-bottom:0;
    }
    .subsite .heading-section{
      margin-top: 1em;
    }
    .subsite .box.card {
      background-color: var(--color-chrome);
      color: var(--color-body-text);
      box-shadow: var(--shadow-standard-y);
      border-radius: 3px;
      padding: 2em;
      border: none;
    }
    .subsite .box .link-cards {
      list-style: none;
      padding: 0;
      margin: 0;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .subsite .box.card .link-cards a {
      margin-bottom: .25em;
      box-shadow: none;
      padding: 1em;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .subsite .box .link-cards a {
      background: var(--color-chrome);
      color: var(--color-body-text);
      box-shadow: var(--shadow-standard-y);
      padding: 1em 2em 1em 5em;
      width: 100%;
      display: block;
      border-radius: 3px;
      font-weight: 600;
      font-size: .8em;
      position: relative;
      transition: all .5s ease;
      margin-bottom: .8em;
      white-space: nowrap;
      overflow: hidden;
      text-transform: capitalize;
    }
    .subsite .box.card .link-cards.no-icon a:hover {
      background-color: var(--color-lane);
      color: var(--color-body-text);
    }

    .subsite #adminBox{
      width:300px;
      position: absolute;
      top:2em;
      right:2em;
    }
    .subsite .meta-data{
      background:var(--color-dark);
      color:var(--color-light);
    }
    .subsite .meta-data h2{
      font-size:1em;
      text-transform:uppercase;
      letter-spacing:2px;
    }
    .simplebar-track.simplebar-vertical{
      right:8px;
    }

    .gizzy-data{
      overflow-x:hidden;
    }

    @media screen and (max-width: 39.9375em) {

    }
    @media screen and (max-height: 650px) {

    }

    @media screen and (min-width: 40em) and (max-width: 63.9375em) {

    }
    .edit .gizzy{
        border:1px dashed var(--color-lane);
        
    }

                .gizzy{
                    margin-bottom:1em;
                }
                .edit .gizzy-content{
                    padding:.5em;
                }
                .gizzy-bar{
                    display:flex;
                    display: flex;
                    justify-content: space-between;
                    background:var(--color-lane);
                    color:var(--color-bright-1);
                    padding:.5em;
                    border-radius: 3px 3px 0 0;
                }
                .gizzy-bar button{
                    color:var(--color-lane-subtle);
                    transition: all .5s ease;
                }
                .gizzy-bar button:hover{
                    color:var(--color-lane-subtler);
                }
                .gizzy-bar .gizzy-drag{
                    justify-self: center;
                }
                .gizzy-bar .gizzy-edit{
                    justify-self: flex-end;
                }
                .gizzy-editor{
                    background: var(--color-body);
                    color:var(--color-body-text);
                    border-radius: 3px;
                    padding: 1em;
                }
                .gizzy-editor .button:not(.clear){
                    background: var(--color-pop);
                    transition: all .5s ease;
                    margin:0;
                }
                .gizzy-editor .button:not(.clear):hover{
                    background: var(--color-pop-h);
                }
                .gizzy-editor .impact-boxes .cell input {
                    display: none;
                    }
                .gizzy-editor .impact-boxes .cell label {
                    border: 1px solid var(--color-lane);
                    padding: .5em;
                    text-align: center;
                    margin: 0;
                    width: 100%;
                    transition: all .5s ease;
                    margin:.5em auto;
                    overflow:hidden;
                    display: flex;
                    flex-direction: column;
                    font-size: .7em;
                }
                .gizzy-editor .impact-boxes .cell label i{
                    font-size: 1.75em;
                }
                .gizzy-editor .impact-boxes .cell input:checked + label {
                    background-color: var(--color-pop);
                    color: var(--color-light);
                    border-color: var(--color-pop-h);
                }
                .gizzy-editor .impact-boxes .cell label:hover {
                    background: var(--color-lane);
                }
                .gizzy-editor p{
                    display: block;
                    margin: 0;
                    font-size: .875rem;
                    font-weight: 600;
                    line-height: 1.8;
                    color: #0a0a0a;
                }
                .gizzy .gizzy-list{

                }
                .gizzy p{
                    margin-bottom: .5em;
                }
                .gizzy .article-card:hover .article-card-title:after {
                    right: 1.25em;
                    color: var(--color-pop);
                }
                .gizzy .article-card{
                    padding-left:0;
                }
                .gizzy-editor textarea{
                    resize:vertical
                }
                /* article */
                .gizzy-data.article, .gizzy-data.article .simplebar-content{
                    display:flex;
                    flex-wrap: wrap;
                    justify-content: flex-start;
                    margin:-.5em;
                }
                .gizzy-data.article .gizzy-data-item{
                    display:flex;
                    min-width: 221px;
                    height:100px;
                    flex: 1 1 0px;
                    padding:1em;
                    box-shadow: var(--shadow-standard-y);
                    background:var(--color-chrome);
                    color:var(--color-body-text);
                    margin:.5em;
                    transition:all .5s ease
                } 
                
                .gizzy-data.article .gizzy-data-item .gizzy-data-title{
                    font-weight: 600;
                    font-size:.875em;
                    border-left:4px solid var(--color-lane);
                    padding-left:.5em;
                    height: fit-content;
                    transition:all .5s ease
                }
                .gizzy-data.article .gizzy-data-item:hover .gizzy-data-title{
                    padding-left:.8em;
                    border-left:4px solid var(--color-bright-1);
                }
                .gizzy-data.article .gizzy-data-item:hover{
                    box-shadow: var(--shadow-standard-y-h);
                }
                /* news */
                .gizzy  .gizzy-data.news .gizzy-data-item{
                  margin: .5em;
                }
                .gizzy-data.news .gizzy-data-item .news-card-details{
                    box-shadow: var(--shadow-standard-y);
                    background:var(--color-chrome);
                    color:var(--color-body-text);
                    transition: all .5s
                }
                .gizzy-data.news .gizzy-data-item .news-card-title  {
                    font-weight: 600;
                    font-size: .875em;
                }

                .gizzy-data.news .gizzy-data-item:hover .news-card-details{
                    box-shadow: var(--shadow-standard-y-h);
                }
                .gizzy.medium-12  .gizzy-data.news,.gizzy.medium-12  .gizzy-data.news .simplebar-content{
                    display:flex;
                    flex-wrap: wrap;
                }
                .gizzy.medium-12  .gizzy-data.news .gizzy-data-item{
                    min-width: calc(50% - 1em);
                }
                .gizzy.medium-12  .gizzy-data.news .gizzy-data-item.oddNumber{
                    min-width: calc(100% - 1em);
                }

                /* spread */
                .gizzy-data.spread, .gizzy-data.spread .simplebar-content{
                    display:flex;
                    flex-wrap: wrap;
                    justify-content: flex-start;
                    margin:-.5em;
                }
                .gizzy-data.spread .gizzy-data-item{
                    display:flex;
                    min-width: 33%;
                    height: 100px;
                    flex: 1 1 0px;
                    padding:1em;
                    box-shadow: var(--shadow-standard-y);
                    background:var(--color-pop);
                    background-size: cover;
                    background-repeat: no-repeat;
                    background-position: center center;
                    color:var(--color-light);
                    margin:.5em;
                    transition:all .5s ease
                } 
                .gizzy-data.spread .gizzy-data-item .gizzy-data-title{
                    font-weight: 600;
                    font-size: 1.25em;
                    line-height: 1;
                    align-self: center;
                    padding-left:.5em;
                    height: fit-content;
                    transition:all .5s ease
                }
                .gizzy-data.spread .gizzy-data-item:hover .gizzy-data-title{
                    

                }
                .gizzy-data.spread .gizzy-data-item:hover{
                    box-shadow: var(--shadow-standard-y-h);
                }
                /* software */
                .gizzy-data.software, .gizzy-data.software .simplebar-content{
                    display:flex;
                    flex-wrap: wrap;
                    justify-content: flex-start;
                    margin:-.5em;
                }
                .gizzy-data.software .gizzy-data-item{
                    display: flex;
                    min-width: 221px;
                    flex-direction: column;
                    height: 125px;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    flex: 1 1 0px;
                    padding: 1em;
                    box-shadow: var(--shadow-standard-y);
                    border-top: 6px solid var(--color-bright-3);
                    background: var(--color-chrome);
                    color: var(--color-body-text);
                    margin: .5em;
                    transition: all .5s ease;
                } 
                .gizzy-data.software .gizzy-data-item .gizzy-data-title{
                    font-weight: 600;
                    font-size:.875em;
                    padding-left:.5em;
                    height: fit-content;
                    transition:all .5s ease;
                    color:hsl(31, 100%, 26%);
                }
                .gizzy-data.software .gizzy-data-item .gizzy-data-icons i{
                    margin:1em;
                }
                .gizzy-data.software .gizzy-data-item .gizzy-data-sub{
                    font-size:.8em;
                }
                .gizzy-data.software .gizzy-data-item:hover .gizzy-data-title{
                    color:var(--color-bright-3);
                }
                .gizzy-data.software .gizzy-data-item:hover{
                    box-shadow: var(--shadow-standard-y-h);
                    border-top: 4px solid var(--color-bright-3);
                }
                /* actions */
                .gizzy.medium-12  .gizzy-data.action .link-cards li{
                    max-width: 50%;
                    width: calc(50% - 1em);
                    margin: .25em .5em;
                }
                .gizzy.medium-12  .gizzy-data.action .link-cards{
                    display: flex;
                    flex-wrap: wrap;
                }
                /* Apps */

                .gizzy-data.app .box.card.app {
                    background: 0 0;
                    position: relative;
                    overflow: visible;
                    padding: 1em;
                    border-radius: 3px;
                    transition: all .5s ease;
                    border: none;
                    flex-direction: column;
                    justify-content: space-between;
                    min-width: 150px;
                    max-width: 200px;
                    box-shadow: none;;
                }
                .gizzy-data.app .box.card.app .img {
                    width: 70px;
                    height: 70px;
                    margin: 0 auto;
                    text-align: center;
                    padding-top: 1.5em;
                    color: var(--color-lane-subtler);
                    background-size: contain;
                    background-position: center;
                    background-repeat: no-repeat;
                }
                .gizzy-data.app .box.card.app .title {
                    color: var(--color-body-text);
                    font-size: .875em;
                    font-weight: 600;
                    margin-top: .5em;
                    margin-bottom: .5em;
                    text-align: center;
                    overflow: hidden;
                    height: auto;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    white-space: normal;
                    line-height: 1;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                    -moz-line-clamp: 2;
                    -moz-box-orient: vertical;
                }
                .gizzy-data.app .grid-x {
                    justify-content: flex-start;
                    width: 100%;
                }
                .gizzy-data.app  .box.card.app:hover {
                    background: var(--color-chrome);
                    box-shadow: var(--shadow-standard-y);
                }
                /* gizzy adder */
                .gizzy-adder{
                    background:var(--color-lane);
                    display:flex;
                    border-radius: 3px;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column;
                    transition: all .5s ease;
                    margin:1em;
                    padding: 1em;
                }
                .gizzy-adder i{
                    font-size:2em;
                    color:var(--color-bright-2);
                }
                .gizzy-adder p{
                    color:var(--color-body-text);
                    font-weight:600;
                }
                .gizzy-adder:hover{
                    background:var(--color-bright-2);
                }
                .gizzy-adder:hover i{
                    color:var(--color-light);
                }
                .gizzy-adder:hover p{
                    color:var(--color-light);
                }
                /* no gizzy */
                .no-gizzy{
                    border: 1px dashed var(--color-lane);
                    display:flex;
                    border-radius: 3px;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column;
                    transition: all .5s ease;
                    margin:1em;
                    padding: 1em;
                }
                .no-gizzy p{
                    color:var(--color-body-text);
                }
                .no-gizzy .button-save{
                    background:var(--color-pop);
                    color: var(--color-light);
                    min-width:25%;
                    padding:.5em;
                    display:flex;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column;
                    transition: all .5s ease;   
                    border-radius:5px;
                }
                .no-gizzy .button-save:hover{
                    background:var(--color-pop-h);
                }
                .no-gizzy .button-save.disabled:hover,.no-gizzy .button-save.disabled{
                    background:var(--color-lane);
                    color:var(--color-lane-subtler);
                }
                #button-delete-gizmo {
                  transition: all .5s ease;
                }
                #button-delete-gizmo.active {
                  color: var(--color-light);
                  background: var(--color-pop);
                }
                #button-delete-gizmo.active:hover {
                  background: var(--color-pop-h);
                }
                #button-delete-gizmo.active i {
                  color: var(--color-light);
                  animation: spin-x 1s ease-in-out .1s none;
                }

                @keyframes spin-x {
                  100% {
                    transform: rotate(-360deg);
                  }
                }
    
  </style>
</head>
<%- include('../partials/layout/top.ejs'); %>

<% if (locals.subsite) { %>
  <input type='hidden' id='subsite-id' name='subsiteID' value='<%= subsite.id %>'>
<% } %>

<% if (locals.edit) { %>
  <input type='hidden' id='update-endpoint' name='updateEndpoint' value='<%= endpoint %>'>
  <input type='hidden' id='update-method' name='updateMethod' value='<%= method %>'>
<% } %>


  <div class="subsite article<%= locals.edit ? ' edit' : ''%>">
    
    <% if (locals.edit) { %>
      <div class="grid-container fluid swim-lane dark">
        <div class="grid-container fluid">
          <div class="grid-x grid-margin-x">
            <div class="cell flex-container medium-4">
              <div class="box card" id="egu"></div>
            </div>
            <div class="cell flex-container medium-4">
              <div class="box card">
                <h2>Tags</h2>
                <ul class="tags">
                  <% if (locals.subsite && subsite.tags.length) { %>
                    <% for (let tag of subsite.tags) { %>
                      <li data-tagid="<%= tag.id %>" class='tag'><a href="#"><%- tag.title %><button class='remove-tag-button'><i class='fas fa-times-circle'></i></button></a></li>
                    <% } %>
                  <% } %>
                  <li data-tagid=""><input type='text' id='add-tag-input'></li>
                </ul>
                <input type="hidden" id="tag" name="tag">
                <h2>Audiences</h2>
                <ul class="audience">
                  <% if (locals.subsite && subsite.audiences.length) { %>
                    <% for (let audience of subsite.audiences) { %>
                      <li data-audienceid="<%= audience.id %>" class='audience-item'><a href="#"><%- audience.title %><button class='remove-audience-button'><i class='fas fa-times-circle'></i></button></a></li>
                    <% } %>
                  <% } %>
                  <li data-audienceid=""><input type='text' id='add-audience-input'></li>
                </ul>
                <input type="hidden" id="audience" name="audience">
              </div>
            </div>
            <div class="cell flex-container medium-4">
              <%- include('./admin-card.ejs'); %>
            </div>
          </div>
        </div>
      </div>
    <% } %>

    <% if (locals.subsite && subsite.image || locals.edit) { %>
      <div class="grid-container fluid section-img" style="background-image:url('<%= locals.subsite && subsite.image ? subsite.image.src : "" %>');">
        <% if (locals.edit) { %>
          <div class="grid-container">
            <div class="grid-y grid-margin-y">
              <div class="cell small-12">
                <input id="file" type="file" accept="image/*" hidden>
                <input id="img-changed" value="false" hidden>
                <input id="img-removed" value="false" hidden>
                <label for="file">
                  <div class="edit-img-button"><i class="far fa-image"></i> Change Image</div>
                </label>
              </div>
              <div class="cell small-12">
                <button id="button-remove-image" class="edit-img-button"<%- locals.subsite && subsite.image ? '' : " style='display: none;'" %>><i class="far fa-minus-circle"></i> Remove Image</button>
              </div>
            </div>
          </div>
        <% } %>
        <% if (!locals.edit && locals.canEdit && locals.subsite && subsite.image) { %>
          <%- include('./admin-card.ejs'); %>
        <% } %>
      </div>
    <% } %>

    <div class="grid-container fluid heading-section">
      <div class="grid-container">
        <nav aria-label="You are here:" role="navigation">
          <ul class="breadcrumbs">
            <li><a href="/"><span class="show-for-sr">Home </span><i class="fas fa-home"></i></a></li>
            <li><a href="/sites">Sites</a></li>
            <li>
              <a href="#">
                <span class="show-for-sr">Current: </span>
                <%- locals.subsite ? subsite.title : '' %>
              </a>
            </li>
          </ul>
        </nav>
        <h1 id="article-title" class="article-heading" <%- contentEditable %> placeholder="Sub Site Title"><%- locals.subsite ? subsite.title : '' %></h1>
      </div>
    </div>

    <% if (locals.subsite && subsite.subSiteFeaturedContents && subsite.subSiteFeaturedContents.length && !locals.edit) { %>
      <div class="grid-container fluid swim-lane" data-size-control='{"display": true, "thiccener":true, "thiccener-item":"grid-container", "preference":true, "preference-storage":"featured"}'>
        <div class="grid-container fluid">
          <div class="grid-x featured-content">

          </div>
        </div>
      </div>
    <% } %>

    <div class="grid-container fluid swim-lane" data-size-control='{"display": true, "thiccener":true, "thiccener-item":"grid-container"}'>
      <div class="grid-container">
        <div id="gizmo-wrapper" class="grid-x grid-margin-x">
          <% function getFoundationClass(width) {
            const map = {
              '25': 'medium-3',
              '33': 'medium-4',
              '50': 'medium-6',
              '66': 'medium-8',
              '75': 'medium-9',
              '100': 'medium-12',
              'auto': 'auto'
            };
            return map[width] || 'auto';
          }
          %>
          <% if (locals.subsite && subsite.gizmos) { %>
            <% for (const gizmo of subsite.gizmos) { %>
              <div class="gizzy cell small-12 <%- getFoundationClass(gizmo.widthPct) %>" style="height: <%= gizmo.maxHeightPx %>; overflow: hidden;" <%- locals.edit ? ` data-gizmo='${JSON.stringify(gizmo).replace(/'/g, "&#39") }'` : ''; %>>
                
                <% if (locals.edit) { %>
                  <div class="gizzy-bar">
                    <i></i>
                    <button class="gizzy-drag"><i class="fas fa-grip-lines"><span class="show-for-sr">Drag to reorder</span></i></button>
                    <button data-gizmoid="<%= gizmo.id %>" class="gizzy-edit"><i class="fas fa-cog"><span class="show-for-sr">Settings</span></i></button>
                  </div>
                <% } %>
                <div class="gizzy-content">
                  <h3 class="gizzy-title"><%- gizmo.title %></h3>
                  <p class="gizzy-text"><%- gizmo.content %></p>
                </div>
                <% if (gizmo.gizmoType !== 'text') { %>
                  <div class="gizzy-data <%= gizmo.displayMode === 'list' ? 'list' : gizmo.gizmoType %>" data-gizmouri="/api/v1/gizmo/data/get/<%= gizmo.id %>">
                  </div>
                <% } %>
              </div>
            <% } %>
          <% } %>
          <% if (locals.edit) { %>
            <% if (locals.subsite) { %>
              <a id="button-add-gizmo" class="gizzy-adder cell small-12 medium-12">
                <i class="fas fa-plus-circle"></i>
                <p>Add New Gizmo</p>
              </a>
            <% } else { %>
              <div class="no-gizzy cell small-12 medium-12">
                <p>Please save your Subsite to get started adding content</p>
                <a class="button-save disabled"><i class="fas fa-save fa-2x"></i> Save</a>
              </div>
            <% } %>
          <% } %>
        </div>
      </div>
      <% if (locals.edit) { %>
        <div class="reveal gizzy-editor" id="gizmo-modal" data-reveal data-close-on-click="false">
          <h2 class="small-12 medium-8">Edit Gizmo</h2>
          <input type="hidden" name="gizmo-id" id="gizmo-id" value="">
          <label for="gizzy-title">Display Title</label>
          <input type="text" id="gizzy-title" name="gizzy-title">
          <label for="gizzy-content">Text Content</label>
          <textarea id="gizzy-content" name="gizzy-content"></textarea>
          <p style="margin-bottom:0;">Gizmo Type</p>
          <div class='grid-x grid-margin-x impact-boxes small-up-2 medium-up-4 large-up-6' style="margin-bottom:.5em;">
            <div class="cell">
              <input type="radio" id="gizmo-text" name="gizmo-type" value="text" style="margin-bottom:.5em;">
              <label for="gizmo-text"><i class='far fa-font'></i> Text</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-article" name="gizmo-type" value="article">
              <label for="gizmo-query-article"><i class='far fa-file-alt'></i> Article</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-news" name="gizmo-type" value="news">
              <label for="gizmo-query-news"><i class='far fa-newspaper'></i> News</label>
            </div>
            <%# TODO actions need tags first
            <div class="cell">
              <input type="radio" id="gizmo-query-action" name="gizmo-type" value="action">
              <label for="gizmo-query-action"><i class='far fa-external-link'></i> Action</label>
            </div>
            %>
            <div class="cell">
              <input type="radio" id="gizmo-query-service" name="gizmo-type" value="service">
              <label for="gizmo-query-service"><i class='far fa-book'></i> Service</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-spread" name="gizmo-type" value="spread">
              <label for="gizmo-query-spread"><i class='far fa-columns'></i> Spreads</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-location" name="gizmo-type" value="location">
              <label for="gizmo-query-location"><i class='far fa-map-marker-alt'></i> Location</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-server" name="gizmo-type" value="server">
              <label for="gizmo-query-server"><i class='far fa-server'></i> Server</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-software" name="gizmo-type" value="software">
              <label for="gizmo-query-software"><i class='far fa-arrow-alt-to-bottom'></i> Software</label>
            </div>
            <div class="cell">
              <input type="radio" id="gizmo-query-component" name="gizmo-type" value="component">
              <label for="gizmo-query-component"><i class='far fa-copy'></i> Component</label>
            </div>
            <%# TODO apps need tags first
            <div class="cell">
              <input type="radio" id="gizmo-query-app" name="gizmo-type" value="app">
              <label for="gizmo-query-app"><i class='far fa-icons'></i> App</label>
            </div>
            %>
          </div>
          <div id="query-options-wrapper">
            <p style="margin-bottom:0;">Query Options</p>
            <div class='grid-x grid-margin-x'>
              <div class="cell small-12 medium-5">
                <label for="gizzy-tags"><i class="far fa-tags"></i> Tags(&)</label>
                <input type="text" id="gizzy-tags" name="gizzy-tags" style="margin-bottom:0;">
                <input type="hidden" id="gizzy-tag" name="gizzy-tag">
                <ul class="tags gizmo-tags">
                </ul>
              </div>
              <div class="cell small-12 medium-2">
                <p style="margin-top: 2em;text-align: center;">And</p>
              </div>
              <div class="cell small-12 medium-5">
                <label for="gizzy-audiences"><i class="far fa-users"></i> Audience(or)</label>
                <input type="text" id="gizzy-audiences" name="gizzy-audiences" style="margin-bottom:0;">
                <input type="hidden" id="gizzy-audience" name="gizzy-audience">
                <ul class="audience gizmo-audiences">
                </ul>
              </div>
            </div>
            <p style="margin-bottom:0;">Sorting</p>
            <div class='grid-x grid-margin-x ' style="margin-bottom:.5em;">
              <div class="cell small-12 medium-4">
                <label><i class="far fa-list-ol"></i> Order By
                  <select id="gizzy-query-orderBy" name="gizzy-query-orderBy">
                    <option value="title">Title</option>
                    <option value="id">ID</option>
                    <option value="createdAt">Date Created</option>
                    <option value="updatedAt">Date Modified</option>
                  </select>
                </label>
              </div>
              <div class="cell small-12 medium-4">
                <label><i class="far fa-sort-amount-down-alt"></i> Sort Order
                  <select id="gizzy-query-order" name="gizzy-query-order">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                  </select>
                </label>
              </div>
              <div class="cell small-12 medium-4">
                <label><i class="far fa-tally"></i> Limit
                  <select id="gizzy-query-limit" name="gizzy-query-limit">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="0">No Limit</option>
                  </select>
                </label>
              </div>
            </div>
          </div>
          <%# show for for all %>
          <p style="margin-bottom:0;">Display Options</p>
          <div class='grid-x grid-margin-x ' style="margin-bottom:.5em;">
            <%# show for this only for query type otherwise make medium-6 into medium-12 for text style below style %>
            <div class="cell small-12 medium-6">
              <label><i class="far fa-th-large"></i> Display Style
                <select id="gizzy-display-style" name="gizzy-display-style">
                  <option value="list">List</option>
                  <option value="component">Component</option>
                </select>
              </label>
            </div>
            <div class="cell small-12 medium-3">
              <label><i class="far fa-arrows-h"></i> Width
                <select id="gizzy-display-width" name="gizzy-display-width">
                  <%# using foundation sizes here small-12 medium-X %>
                  <option value="100">100%</option>
                  <option value="75">75%</option>
                  <option value="66">66%</option>
                  <option value="50">50%</option>
                  <option value="33">33%</option>
                  <option value="25">25%</option>
                  <option value="auto">Auto</option>
                </select>
              </label>
            </div>
            <div class="cell small-12 medium-3">
              <label for="gizzy-display-mheight"><i class="far fa-arrows-v"></i> Max Height
                <select id="gizzy-display-mheight" name="gizzy-display-mheight">
                  <option value="200px">Short(200px)</option>
                  <option value="325px">Smedium(350px)</option>
                  <option value="500px">Medium(500px)</option>
                  <option value="650px">Tall-ish(650px)</option>
                  <option value="800px">Tall(800px)</option>
                  <option value="auto">Auto</option>
                  <option value="100%">100%</option>
                </select>
              </label>
            </div>
          </div>
      
      
          <button id="button-create-gizmo" type="button" class="button expanded">Add</button>
          <button id="button-update-gizmo" type="button" class="button expanded" style="display: none;">Save</button>
          <div class="grid-x">
            <button class="button clear small-6" id="button-delete-gizmo"><i class="fa fa-trash"></i> Delete</button>
            <button type="button" class="button clear auto" style="flex-grow: 1;" data-close>Cancel</button>
          </div>
        </div>
      <% } /* end edit modal */ %>
    </div>

    <% if (!locals.edit && locals.subsite && ((subsite.tags && subsite.tags.length) || (subsite.audiences && subsite.audiences.length))) { %>

      <div class="grid-container fluid swim-lane meta-data">
        <div class="grid-container">
          <div class="grid-x grid-margin-x">
            <% if (subsite.tags && subsite.tags.length) { %>
              <div class="cell small-12 medium-6">
                <h2>Tags</h2>
                <ul class="tags">
                  <% for (const tag of subsite.tags) { %>
                    <li><a href="/tag/<%= tag.id %>"><%- tag.title %></a></li>
                  <% } %>
                </ul>
              </div>
            <% } %>
            <% if (subsite.audiences && subsite.audiences.length) { %>
              <div class="cell small-12 medium-6">
                <h2>Audiences</h2>
                <ul class="audience">
                  <% for (const audience of subsite.audiences) { %>
                    <li><a href="/audience/<%= audience.id %>"><%- audience.title %></a></li>
                  <% } %>
                </ul>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    <% } %>

  </div>


<% if (locals.edit) { %>
  <%- include('../partials/components/edit.ejs', {
    entityTitle: 'Sub Site',
    entityID: locals.subsite && subsite.id ? subsite.id : 'New'
  }); %>

  <%

    const toasts = [
      {
        id: 'toast-save-success',
        type: 'success',
        title: 'Success',
        message: 'SubSite has been saved',
        show: false
      },
      {
        id: 'toast-save-error',
        type: 'error',
        title: 'Whoops',
        message: 'Something went wrong trying to save your SubSite',
        show: false
      }
    ];

  %>
  <%- include('../partials/components/toaster.ejs', { toasts }); %>
<% } %>


<% if (locals.edit && locals.subsite) { %>
  <%- include('../partials/components/preview-modal.ejs'); %>
<% } %>


<% if (locals.edit) { %>
  <div class="reveal" id="modal-console-add" data-reveal data-options="closeOnClick:false;">
    <h4>New Featured Content</h4>
    <label for="title">Title</label>
    <input type="text" id="title" name="title" placeholder="Title">
    <label for="link">Link</label>
    <input type="text" id="link" name="link" placeholder="https://www.example.com/">
    <p style='margin-bottom:0'>Published</p>
    <div class="switch">
      <input class="switch-input" id="published" type="checkbox" name="published">
      <label class="switch-paddle" for="published">
        <span class='show-for-sr'>Published</span>
        <span class='switch-active'>Yes</span>
        <span class='switch-inactive'>No</span>
      </label>
    </div>
    <label for="img">Image Upload</label>
    <input type="file" name="img" id="img" accept="image/*">
    <label for="position">Background Image Position</label>
    <select id="position" name="position">
      <% for (let position of contentPositions) { %>
        <option value="<%= position.id %>"><%= position.title %></option>
      <% } %>
    </select>
    <button class="console-add console-add-save"><i class="fas fa-save"></i> Create</button>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true"><i class='fas fa-times'></i></span>
    </button>
  </div>

  <div class="reveal" id="modal-console-edit" data-reveal data-options="closeOnClick:false;">
    <h4>Edit Featured Content</h4>
    <input type="hidden" id="edit-id" name="edit-id">
    <label for="edit-title">Title</label>
    <input type="text" id="edit-title" name="edit-title" placeholder="Title">
    <label for="edit-link">Link</label>
    <input type="text" id="edit-link" name="edit-link" placeholder="https://www.example.com/">
    <p style='margin-bottom:0'>Published</p>
    <div class="switch">
      <input class="switch-input" id="edit-published" type="checkbox" name="edit-published">
      <label class="switch-paddle" for="edit-published">
        <span class='show-for-sr'>Published</span>
        <span class='switch-active'>Yes</span>
        <span class='switch-inactive'>No</span>
      </label>
    </div>
    <input type="hidden" name="edit-img-changed" id="edit-img-changed" value="false">
    <label for="edit-img">Image Upload</label>
    <input type="file" name="edit-img" id="edit-img" accept="image/*">
    <label for="position">Background Image Position</label>
    <select id="edit-position" name="edit-position">
      <% for (let position of contentPositions) { %>
        <option value="<%= position.id %>"><%= position.title %></option>
      <% } %>
    </select>
    <button class="console-add console-edit-save"><i class="fas fa-save"></i> Save</button>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true"><i class='fas fa-times'></i></span>
    </button>
  </div>

  <div class="reveal console-modal" id="featured-content-modal" data-reveal data-options="closeOnClick:false;" data-simplebar>
    <div>
      <h2>Featured Content</h2>
      <a class="console-add" id='console-add' href="#"><i class="far fa-plus-circle"></i> New Featured Content</a>
      <h3>Published</h3>
      <table class='table' id='featured-content-published-table'>
        <thead class="show-for-sr">
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th></th>
          </tr>
        </thead>
        <tbody id='featured-content-published-table-tbody'>
          <% if (locals.featuredContents) { %>
            <% for (const item of featuredContents.filter(s => s.isPublished)) { %>
              <tr>
                <td><%= item.id %></td>
                <td><%= item.title %></td>
                <td class="action-links">
                  <a href="#" class="button-edit" data-metaid="<%= item.id %>" data-metatitle="<%= item.title %>" data-metalink="<%= item.link %>" data-positionid="<%= item.idPosition %>"><i class="far fa-fw fa-edit"></i> </a>
                  <a href="#" data-metaid="<%= item.id %>" class="button-unpublish"><i class="far fa-fw fa-eye-slash"></i> </a>
                  <%# <a href="#" class="button-delete"><i class="far fa-fw fa-trash"></i> </a> %>
                </td>
              </tr>
            <% } %>
          <% } %>
        </tbody>
      </table>
      <h3>Unpublished</h3>
      <table class='table' id='featured-content-unpublished-table'>
        <thead class="show-for-sr">
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% if (locals.featuredContents) { %>
            <% for (const item of featuredContents.filter(s => !s.isPublished)) { %>
              <tr>
                <td><%= item.id %></td>
                <td><%= item.title %></td>
                <td class="action-links">
                  <a href="#" class="button-edit" data-metaid="<%= item.id %>" data-metatitle="<%= item.title %>" data-metalink="<%= item.link %>" data-positionid="<%= item.idPosition %>"><i class="far fa-fw fa-edit"></i> </a>
                  <a href="#" data-metaid="<%= item.id %>" class="button-publish"><i class="far fa-fw fa-eye"></i> </a>
                  <%# <a href="#" class="button-delete"><i class="far fa-fw fa-trash"></i> </a> %>
                </td>
              </tr>
            <% } %>
          <% } %>
        </tbody>
      </table>
    </div>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true"><i class='far fa-times'></i></span>
    </button>
  </div>

  <div class="reveal console-modal" id="advanced-settings-modal" data-reveal data-options="closeOnClick:false;" data-simplebar>
    <ul class="tabs" data-tabs id="advancedSettingsTabs">
      <li class="tabs-title is-active"><a href="#phaseTab" aria-selected="true"><i class='far fa-satellite-dish'></i> State</a></li>
      <li class="tabs-title"><a href="#auditTab"><i class='far fa-history'></i> Audit</a></li>
    </ul>
    <div data-tabs-content="advancedSettingsTabs">
      <div id="phaseTab" class="tabs-panel is-active">
        <% if (locals.canPublish) { %>
          <label for="phase">Phase</label>
          <select name="phase" id="phase" class='title-case'>
          <% for (let phase of phases) { %>
            <option class='title-case' value="<%= phase.id %>" <%= locals.subsite && subsite.idSubSitePhase == phase.id ? 'selected' : '' %>><%= phase.title %></option>
          <% } %>
          </select>
        <% } else { %>
          <input type="hidden" id="phase" value="1">
        <% } %>
        <label for="title-route">Route Title</label>
        <input type="text" name="title-route" id="title-route" value="<%- locals.subsite ? subsite.titleRoute : '' %>">
        <p>Public</p>
        <div class="switch">
          <input class="switch-input" id="isPublic" type="checkbox" name="isPublic" <%- locals.subsite && subsite.isPublic ? 'checked' : '' %>>
          <label class="switch-paddle" for="isPublic">
            <span class='show-for-sr'>Public</span>
            <span class='switch-active'>Yes</span>
            <span class='switch-inactive'>No</span>
          </label>
        </div>
        <p>Featured</p>
        <div class="switch">
          <input class="switch-input" id="isFeatured" type="checkbox" name="isFeatured" <%- locals.subsite && subsite.isFeatured ? 'checked' : '' %>>
          <label class="switch-paddle" for="isFeatured">
            <span class='show-for-sr'>Featured</span>
            <span class='switch-active'>Yes</span>
            <span class='switch-inactive'>No</span>
          </label>
        </div>
      </div>
      <div id="auditTab" class="tabs-panel">
        <h2>Details</h2>
        <p><strong>Date Review By: </strong><%= locals.subsite && subsite.dateReviewBy ? moment(subsite.dateReviewBy).format('ll') : '' %></p>
        <p><strong>Created On: </strong><%= locals.subsite && subsite.createdAt ? moment(subsite.createdAt).format('ll') : '' %></p>
        <p><strong>Created By: </strong><%= locals.subsite && subsite.userCreatedBy && subsite.userCreatedBy.username ? subsite.userCreatedBy.username : '' %></p>
        <p><strong>Modified On: </strong><%= locals.subsite && subsite.updatedAt ? moment(subsite.updatedAt).format('ll') : '' %></p>
        <p><strong>Last Modified By: </strong><%= locals.subsite && subsite.userModifiedBy && subsite.userModifiedBy.username ? subsite.userModifiedBy.username : '' %></p>
      </div>
    </div>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true"><i class='far fa-times'></i></span>
    </button>
  </div>
<% } %>


<%- include('../partials/layout/bottom.ejs') %>
</html>
